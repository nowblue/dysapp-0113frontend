# dysapp PRD (Product Requirements Document)

> **Version:** 1.0 (Created: 2025-01-27)
> **Status:** Initial Draft
> **Single Source of Truth:** `docs/postdocs/baseline_spec.md`
> **í”„ë¡œì íŠ¸ëª…:** dysapp (Firebase Project ID: dysapp1210)

---

## ëª©ì°¨

1. [ë¬¸ì„œ ê°œìš”](#1-ë¬¸ì„œ-ê°œìš”)
2. [í”„ë¡œì íŠ¸ ë°°ê²½ ë° ë¬¸ì œ ì •ì˜](#2-í”„ë¡œì íŠ¸-ë°°ê²½-ë°-ë¬¸ì œ-ì •ì˜)
3. [ëª©í‘œ ë° í•µì‹¬ ì„±ê³µ ì§€í‘œ](#3-ëª©í‘œ-ë°-í•µì‹¬-ì„±ê³µ-ì§€í‘œ)
4. [ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ë° í˜ë¥´ì†Œë‚˜](#4-ì‚¬ìš©ì-ì‹œë‚˜ë¦¬ì˜¤-ë°-í˜ë¥´ì†Œë‚˜)
5. [ì‚¬ì´íŠ¸ë§µ ë° ì •ë³´ êµ¬ì¡°](#5-ì‚¬ì´íŠ¸ë§µ-ë°-ì •ë³´-êµ¬ì¡°)
6. [íƒœìŠ¤í¬ í”Œë¡œìš°](#6-íƒœìŠ¤í¬-í”Œë¡œìš°)
7. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#7-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
8. [ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ ê°œìš”](#8-ê¸°ëŠ¥-ìš”êµ¬ì‚¬í•­-ê°œìš”)
9. [ì±—ë´‡ ë ˆì´ì–´ ë° ìš°ì„ ìˆœìœ„ ê·œì¹™](#9-ì±—ë´‡-ë ˆì´ì–´-ë°-ìš°ì„ ìˆœìœ„-ê·œì¹™)
10. [ì±—ë´‡ ë°±ì—”ë“œ í”„ë ˆì„ì›Œí¬ ë° í”Œë¡œìš°](#10-ì±—ë´‡-ë°±ì—”ë“œ-í”„ë ˆì„ì›Œí¬-ë°-í”Œë¡œìš°)
11. [ë°ì´í„° ì „ëµ](#11-ë°ì´í„°-ì „ëµ)
12. [ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„](#12-ëª¨ë‹ˆí„°ë§-ë°-ë¶„ì„)
13. [ë¦¬ìŠ¤í¬ ë° ëŒ€ì‘ ë°©ì•ˆ](#13-ë¦¬ìŠ¤í¬-ë°-ëŒ€ì‘-ë°©ì•ˆ)
14. [ë¶€ë¡](#14-ë¶€ë¡)
15. [ì‹¤ì½”ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ](#15-ì‹¤ì½”ë“œ-ë§ˆì´ê·¸ë ˆì´ì…˜-ê°€ì´ë“œ)

---

## 1. ë¬¸ì„œ ê°œìš”

### 1.1 ë¬¸ì„œ ëª©ì 

ì´ ë¬¸ì„œëŠ” **dysapp**ì˜ ì œí’ˆ ìš”êµ¬ì‚¬í•­ì„ ì •ì˜í•©ë‹ˆë‹¤. dysappì€ ë””ìì¸ ì´ë¯¸ì§€ë¥¼ AI ê¸°ë°˜ìœ¼ë¡œ ë¶„ì„í•˜ê³ , 3-Layer í‰ê°€ í”„ë ˆì„ì›Œí¬ë¥¼ í†µí•´ ê°ê´€ì  í”¼ë“œë°±ì„ ì œê³µí•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.

**í•µì‹¬ íŠ¹ì§•:**
- ìˆœìˆ˜ HTML/CSS/JavaScript ê¸°ë°˜ í”„ë¡ íŠ¸ì—”ë“œ (ES Modules)
- Firebase Cloud Functions v2 ê¸°ë°˜ ë°±ì—”ë“œ
- Gemini AI (Vision, Chat, Embedding) í†µí•©
- Firestore Native Vector Search

### 1.2 ë¬¸ì„œ ìŠ¤ìœ„íŠ¸ êµ¬ì„±

ì´ ë¬¸ì„œëŠ” dysappì˜ ì œí’ˆ ìš”êµ¬ì‚¬í•­ì„ ì •ì˜í•˜ë©°, ë‹¤ìŒ ë¬¸ì„œ ìŠ¤ìœ„íŠ¸ì™€ í•¨ê»˜ ì‚¬ìš©ë©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BASELINE_SPEC.MD (ì°¸ì¡° ë¬¸ì„œ)                            â”‚
â”‚                      (Single Source of Truth)                                â”‚
â”‚  - Model names: gemini-3-pro-preview, gemini-2.5-flash                      â”‚
â”‚  - Embedding: multimodalembedding@001 (512-dim)                             â”‚
â”‚  - Vector Strategy: Firestore Native (Strategy A)                           â”‚
â”‚  - Case conventions: LLM(snake) â†’ Firestore(camel) â†’ BigQuery(snake)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                     â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  dysapp_PRD.md   â”‚   â”‚  dysapp_FRD.md   â”‚   â”‚  dysapp_TSD.md  â”‚   â”‚  dysapp_SRD.md  â”‚
â”‚  (ì´ ë¬¸ì„œ)       â”‚   â”‚  (ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­) â”‚   â”‚  (ê¸°ìˆ  ëª…ì„¸)    â”‚   â”‚  (ì‹œìŠ¤í…œ ìš”êµ¬)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                     â”‚                     â”‚                     â”‚
          â–¼                     â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ dysapp_APISPEC.mdâ”‚   â”‚  (ì°¸ì¡°)         â”‚   â”‚  (ì°¸ì¡°)         â”‚   â”‚  (ì°¸ì¡°)         â”‚
â”‚  (API ëª…ì„¸)      â”‚   â”‚  baseline_spec   â”‚   â”‚  schima.md      â”‚   â”‚  framework.md   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì°¸ì¡° ë¬¸ì„œ ìœ„ì¹˜**: `C:\dysprototype\docs\postdocs\`

### 1.3 í”„ë¡œì íŠ¸ ì •ë³´

| í•­ëª© | ê°’ |
|------|-----|
| **í”„ë¡œì íŠ¸ëª…** | dysapp |
| **Firebase Project ID** | dysapp1210 |
| **í”„ë¡œì íŠ¸ ë²ˆí˜¸** | 702244172468 |
| **ìƒˆ í”„ë¡ íŠ¸ì—”ë“œ ê²½ë¡œ** | `C:\dysapp\dys_prototype` |
| **ì‘ì—… ë””ë ‰í† ë¦¬** | `C:\dysprototype` |
| **Storage Bucket** | `gs://dysapp1210.firebasestorage.app` |
| **Storage ë¦¬ì „** | `asia-northeast3` (ì„œìš¸) |
| **Firestore ë°ì´í„°ë² ì´ìŠ¤ ID** | `dysapp` |
| **Firestore ë¦¬ì „** | `nam5` (ì˜ˆì™¸) |
| **Cloud Functions ë¦¬ì „** | `asia-northeast3` |

### 1.4 í•µì‹¬ ìƒìˆ˜ ìš”ì•½

| í•­ëª© | ê°’ | ìš©ë„ |
|------|-----|------|
| **Vision Model** | `gemini-3-pro-preview` | ë””ìì¸ ë¶„ì„ |
| **Chat Model** | `gemini-2.5-flash` | ë©˜í† ë§ ì±—ë´‡ |
| **Embedding Model** | `multimodalembedding@001` | ì´ë¯¸ì§€ ë²¡í„°í™” |
| **Embedding Dimension** | 512 | ë²¡í„° ì°¨ì› |
| **Vector Strategy** | Firestore Native (Strategy A) | ìœ ì‚¬ ë””ìì¸ ê²€ìƒ‰ |
| **Analysis Version** | 1 | í”„ë¡¬í”„íŠ¸/ë©”íŠ¸ë¦­ ë²„ì „ |
| **Embedding Version** | 1 | ì„ë² ë”© ëª¨ë¸ ë²„ì „ |

---

## 2. í”„ë¡œì íŠ¸ ë°°ê²½ ë° ë¬¸ì œ ì •ì˜

### 2.1 ë¬¸ì œ ì •ì˜

- **ë¹„ì „ê³µ ë””ìì´ë„ˆì˜ ì¦ê°€**: ë…¸ì½”ë“œ/AI ë„êµ¬ í™•ì‚°ìœ¼ë¡œ ë””ìì¸ì„ ì§ì ‘ í•˜ëŠ” ë¹„ì „ê³µìê°€ ëŠ˜ì–´ë‚¨
- **ë””ìì¸ í”¼ë“œë°±ì˜ ë¶€ì¬**: ì „ë¬¸ê°€ í”¼ë“œë°±ì„ ë°›ê¸° ì–´ë µê³ , ë¹„ìš©ì´ ë†’ìŒ
- **ê°ê´€ì  ê¸°ì¤€ì˜ ë¶€ì¬**: "ì¢‹ì€ ë””ìì¸"ì— ëŒ€í•œ ì²´ê³„ì  í‰ê°€ ê¸°ì¤€ì´ í•„ìš”
- **í•™ìŠµ ê²½ë¡œì˜ ë¶€ì¬**: ë¬´ì—‡ì„ ì–´ë–»ê²Œ ê°œì„ í•´ì•¼ í•˜ëŠ”ì§€ êµ¬ì²´ì  ê°€ì´ë“œ ë¶€ì¡±

### 2.2 dysapp ì†”ë£¨ì…˜

- **3-Layer í‰ê°€ í”„ë ˆì„ì›Œí¬**: ì •ë³´ë””ìì¸ ì´ë¡  ê¸°ë°˜ ê°ê´€ì  í‰ê°€
- **AI ë””ìì¸ ë©˜í† **: fixScope ê¸°ë°˜ ìš°ì„ ìˆœìœ„ í”¼ë“œë°±
- **ìœ ì‚¬ ë””ìì¸ ê²€ìƒ‰**: ë²¡í„° ìœ ì‚¬ë„ ê¸°ë°˜ ë ˆí¼ëŸ°ìŠ¤ ì œê³µ
- **ì§€ì‹ ë² ì´ìŠ¤ ì—°ë™**: í•™ìˆ  ê·¼ê±° ê¸°ë°˜ ì¡°ì–¸ (v2+)

### 2.3 íƒ€ê²Ÿ ì‹œì¥

- **Primary**: ë””ìì¸ ë¹„ì „ê³µ ì°½ì—…ì/ë§ˆì¼€í„°
- **Secondary**: ë””ìì¸ í•™ìƒ/ì£¼ë‹ˆì–´ ë””ìì´ë„ˆ
- **Tertiary**: ë””ìì¸ êµìœ¡ ê¸°ê´€

---

## 3. ëª©í‘œ ë° í•µì‹¬ ì„±ê³µ ì§€í‘œ

### 3.1 v1 ëª©í‘œ

| ëª©í‘œ | ì¸¡ì • ì§€í‘œ | ëª©í‘œê°’ |
|------|----------|--------|
| **ë¶„ì„ ì •í™•ë„** | ì „ë¬¸ê°€ í‰ê°€ì™€ ì¼ì¹˜ìœ¨ | > 70% |
| **ì‘ë‹µ ìœ ìš©ì„±** | ì‚¬ìš©ì ë§Œì¡±ë„ (1-5) | > 3.5 |
| **ì‹œìŠ¤í…œ ì•ˆì •ì„±** | ë¶„ì„ ì„±ê³µë¥  | > 95% |
| **ì‘ë‹µ ì†ë„** | Vision ë¶„ì„ í‰ê·  ì‹œê°„ | < 10s |

### 3.2 KPI ì •ì˜

```
ë¶„ì„ ì™„ë£Œìœ¨ = ì„±ê³µí•œ ë¶„ì„ / ì‹œë„í•œ ë¶„ì„ Ã— 100
ì¬ë°©ë¬¸ìœ¨ = 2íšŒ ì´ìƒ ë¶„ì„ ì‚¬ìš©ì / ì „ì²´ ì‚¬ìš©ì Ã— 100
ì±„íŒ… ì°¸ì—¬ë„ = í‰ê·  ë©”ì‹œì§€ ìˆ˜ / ì„¸ì…˜
```

---

## 4. ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ë° í˜ë¥´ì†Œë‚˜

### 4.1 í•µì‹¬ í˜ë¥´ì†Œë‚˜

#### í˜ë¥´ì†Œë‚˜ A: ìŠ¤íƒ€íŠ¸ì—… ëŒ€í‘œ "ë¯¼ì¤€"
- **íŠ¹ì„±**: 30ëŒ€, IT ì°½ì—…ì, ë””ìì¸ ë¹„ì „ê³µ
- **ë‹ˆì¦ˆ**: íˆ¬ì í”¼ì¹­ë±ì˜ ì‹œê°ì  ì™„ì„±ë„ ê²€ì¦
- **í–‰ë™**: ë¹ ë¥¸ í”¼ë“œë°±, êµ¬ì²´ì  ìˆ˜ì • í¬ì¸íŠ¸ ì›í•¨
- **Pain**: "ì–´ë””ê°€ ë¬¸ì œì¸ì§€ ëª¨ë¥´ê² ì–´ìš”"

#### í˜ë¥´ì†Œë‚˜ B: ë§ˆì¼€íŒ… ë‹´ë‹¹ì "ìˆ˜í˜„"
- **íŠ¹ì„±**: 20ëŒ€, ì¤‘ì†Œê¸°ì—… ë§ˆì¼€í„°
- **ë‹ˆì¦ˆ**: SNS ì¸ë„¤ì¼/ê´‘ê³  ì´ë¯¸ì§€ ê°œì„ 
- **í–‰ë™**: ì—¬ëŸ¬ ë²„ì „ ë¹„êµ, CTR ì—°ê´€ ì¡°ì–¸ ì›í•¨
- **Pain**: "ë””ìì´ë„ˆ ì—†ì´ í˜¼ì í•´ì•¼ í•´ìš”"

#### í˜ë¥´ì†Œë‚˜ C: ë””ìì¸ í•™ìƒ "ì§€í›ˆ"
- **íŠ¹ì„±**: 20ëŒ€, ì‹œê°ë””ìì¸ í•™ë¶€ 3í•™ë…„
- **ë‹ˆì¦ˆ**: í¬íŠ¸í´ë¦¬ì˜¤ ì‚¬ì „ ì ê²€, ì´ë¡  í•™ìŠµ
- **í–‰ë™**: ì™œ ê·¸ëŸ°ì§€ ê·¼ê±° ìˆëŠ” ì„¤ëª… ì›í•¨
- **Pain**: "êµìˆ˜ë‹˜ í”¼ë“œë°±ë§Œìœ¼ë¡  ë¶€ì¡±í•´ìš”"

### 4.2 ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ë””ìì¸ ë¶„ì„

```
1. ì‚¬ìš©ìê°€ index.htmlì—ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ
2. analyzeDesign Cloud Function í˜¸ì¶œ
3. Vision AIê°€ 3-Layer ë¶„ì„ ìˆ˜í–‰
4. analyze.htmlì—ì„œ ê²°ê³¼ ë¦¬í¬íŠ¸ í‘œì‹œ:
   - í¬ë§· ì˜ˆì¸¡ (Thumbnail, Poster ë“±)
   - Layer 1-3 ì ìˆ˜
   - fixScope (StructureRebuild / DetailTuning)
   - ìƒ‰ìƒ íŒ”ë ˆíŠ¸, í‚¤ì›Œë“œ
   - êµ¬ì²´ì  ê°œì„  ì•¡ì…˜ 3ê°€ì§€
5. ì‚¬ìš©ìê°€ ë©˜í†  ì±„íŒ…ìœ¼ë¡œ ì¶”ê°€ ì§ˆë¬¸
```

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ë©˜í†  ì±„íŒ…

```
1. analyze.htmlì—ì„œ "ë©˜í† ì—ê²Œ ì§ˆë¬¸í•˜ê¸°" í´ë¦­
2. ë¶„ì„ ì»¨í…ìŠ¤íŠ¸ ìë™ ë¡œë“œ
3. ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥
4. chatWithMentor Cloud Function í˜¸ì¶œ
5. AI ë©˜í† ê°€ fixScope ê¸°ë°˜ ìš°ì„ ìˆœìœ„ ì¡°ì–¸
6. ëŒ€í™” íˆìŠ¤í† ë¦¬ ì €ì¥
```

#### ì‹œë‚˜ë¦¬ì˜¤ 3: ìœ ì‚¬ ë””ìì¸ ê²€ìƒ‰

```
1. searchTab.htmlì—ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ ë˜ëŠ” í…ìŠ¤íŠ¸ ê²€ìƒ‰
2. searchSimilar Cloud Function í˜¸ì¶œ (Vector Search)
3. filter.htmlì—ì„œ í•„í„° ì˜µì…˜ ì ìš© (í¬ë§·, fixScope, ì ìˆ˜ ë²”ìœ„)
4. ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ì—ì„œ ë ˆí¼ëŸ°ìŠ¤ íƒìƒ‰
```

---

## 5. ì‚¬ì´íŠ¸ë§µ ë° ì •ë³´ êµ¬ì¡°

### 5.1 ì „ì²´ ì‚¬ì´íŠ¸ë§µ

```
dysapp
â”‚
â”œâ”€â”€ ğŸ“¤ index.html (ì—…ë¡œë“œ í˜ì´ì§€)
â”‚   â”œâ”€â”€ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜ì—­
â”‚   â”‚   â”œâ”€â”€ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì˜ì—­
â”‚   â”‚   â”œâ”€â”€ íŒŒì¼ ì„ íƒ ë²„íŠ¼
â”‚   â”‚   â””â”€â”€ íŒŒì¼ í¬ë§· ê°€ì´ë“œ í…ìŠ¤íŠ¸
â”‚   â”œâ”€â”€ í”„ë¡¬í”„íŠ¸ ì…ë ¥ ì˜ì—­ (ì„ íƒì‚¬í•­)
â”‚   â”œâ”€â”€ ë¶„ì„ ì‹œì‘ ë²„íŠ¼
â”‚   â””â”€â”€ ë¶„ì„ íˆìŠ¤í† ë¦¬ ëª¨ë‹¬
â”‚
â”œâ”€â”€ ğŸ“Š analyze.html (ë¶„ì„ ê²°ê³¼ í˜ì´ì§€)
â”‚   â”œâ”€â”€ ë¶„ì„ ì •ë³´ (íŒŒì¼ëª…, ë¶„ì„ ì¼ì‹œ)
â”‚   â”œâ”€â”€ AI ìš”ì•½ (H1Text)
â”‚   â”œâ”€â”€ ì£¼ìš” ì£¼ì œ íƒœê·¸ (per, per2, per3, per4)
â”‚   â”œâ”€â”€ ë°ì´í„° ë°•ìŠ¤ë“¤:
â”‚   â”‚   â”œâ”€â”€ ìƒ‰ìƒ íŒ”ë ˆíŠ¸
â”‚   â”‚   â”œâ”€â”€ ê°ì§€ëœ ê°ì²´
â”‚   â”‚   â”œâ”€â”€ í™œìš© ì œì•ˆ
â”‚   â”‚   â”œâ”€â”€ ë ˆì´ì•„ì›ƒ (Count, Width, Margin, Gutter)
â”‚   â”‚   â””â”€â”€ íƒ€ì´í¬ê·¸ë˜í”¼
â”‚   â””â”€â”€ AI ë©˜í†  ì±„íŒ… (í•˜ë‹¨ ê³ ì •)
â”‚
â”œâ”€â”€ ğŸ” searchTab.html (ê²€ìƒ‰ í˜ì´ì§€)
â”‚   â”œâ”€â”€ ê²€ìƒ‰ íŒ¨ë„
â”‚   â”‚   â”œâ”€â”€ í…ìŠ¤íŠ¸ ê²€ìƒ‰ ë°•ìŠ¤
â”‚   â”‚   â”œâ”€â”€ ì´ë¯¸ì§€ ì—…ë¡œë“œ ë²„íŠ¼
â”‚   â”‚   â””â”€â”€ ê²€ìƒ‰ ë²„íŠ¼
â”‚   â”œâ”€â”€ ì¹´í…Œê³ ë¦¬ í•„í„° íŒ¨ë„
â”‚   â”‚   â”œâ”€â”€ ë‚˜ì˜ ìŠ¤íƒ€ì¼
â”‚   â”‚   â”œâ”€â”€ ë‚˜ì˜ ë ˆí¼ëŸ°ìŠ¤
â”‚   â”‚   â””â”€â”€ ì¶”ê°€ ì¸ì‚¬ì´íŠ¸
â”‚   â”œâ”€â”€ í•„í„° ë²„íŠ¼ (filter.htmlë¡œ ì´ë™)
â”‚   â””â”€â”€ ê²€ìƒ‰ ê²°ê³¼ ê·¸ë¦¬ë“œ
â”‚
â”œâ”€â”€ ğŸ”§ filter.html (í•„í„° í˜ì´ì§€)
â”‚   â”œâ”€â”€ ê²€ìƒ‰ í•„í„° ì„¹ì…˜
â”‚   â”‚   â”œâ”€â”€ ë‚´ ì„ í˜¸ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
â”‚   â”‚   â”œâ”€â”€ ë‚´ í•„í„° ë¶ˆëŸ¬ì˜¤ê¸°
â”‚   â”‚   â””â”€â”€ í˜„ì¬ í•„í„° ì €ì¥
â”‚   â”œâ”€â”€ ì„ í˜¸ ìŠ¤íƒ€ì¼ ì„¹ì…˜ (ìƒ‰ìƒ, ê´€ì‹¬ ì¹´í…Œê³ ë¦¬, ì¢…í•©ë¶„ì„)
â”‚   â””â”€â”€ í•„í„° ì˜µì…˜ë“¤ (í¬ë§·, fixScope, ì ìˆ˜ ë²”ìœ„ ë“±)
â”‚
â”œâ”€â”€ ğŸ‘¤ mypage.html (ë§ˆì´í˜ì´ì§€)
â”‚   â””â”€â”€ (í˜„ì¬ ë¹„ì–´ìˆìŒ - êµ¬í˜„ í•„ìš”)
â”‚
â””â”€â”€ ğŸ“„ search_detail_tab.html (ê²€ìƒ‰ ìƒì„¸)
    â””â”€â”€ (ê²€ìƒ‰ ê²°ê³¼ ìƒì„¸ ë³´ê¸°)
```

### 5.2 ë„¤ë¹„ê²Œì´ì…˜ êµ¬ì¡°

**ìœ„ì¹˜**: `nav.html` (ê³µí†µ ì»´í¬ë„ŒíŠ¸)

**êµ¬ì„±**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   [ë¡œê³ ]        â”‚ â† ìƒë‹¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚
â”‚  ğŸ“¤ ì—…ë¡œë“œ      â”‚ â† index.html
â”‚  ğŸ“Š ë¶„ì„        â”‚ â† analyze.html
â”‚  ğŸ” ê²€ìƒ‰        â”‚ â† searchTab.html
â”‚  ğŸ‘¤ ë§ˆì´í˜ì´ì§€  â”‚ â† mypage.html
â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš™ï¸ ì„¤ì •        â”‚ â† (í–¥í›„)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¸í„°ë™ì…˜**:
- ê° ë©”ë‰´ ì•„ì´ì½˜ í´ë¦­ ì‹œ í•´ë‹¹ HTML íŒŒì¼ë¡œ ì´ë™
- í˜„ì¬ í˜ì´ì§€ í•˜ì´ë¼ì´íŠ¸ í‘œì‹œ
- `includHTML.js`ë¥¼ í†µí•œ ì»´í¬ë„ŒíŠ¸ ë¡œë“œ

### 5.3 í˜ì´ì§€ ê°„ ì „í™˜ í”Œë¡œìš°

#### 5.3.1 ì—…ë¡œë“œ â†’ ë¶„ì„ í”Œë¡œìš°

```
index.html (ì—…ë¡œë“œ)
  â†“ (ì´ë¯¸ì§€ ì„ íƒ)
  â†“ (analyzeDesign API í˜¸ì¶œ)
  â†“ (localStorageì— analysisId ì €ì¥)
analyze.html (ê²°ê³¼ í‘œì‹œ)
  â†“ (URL íŒŒë¼ë¯¸í„° ë˜ëŠ” localStorageì—ì„œ analysisId ì½ê¸°)
  â†“ (getAnalysis API í˜¸ì¶œ)
  â†“ (dataAdapter.jsë¡œ ë°ì´í„° ë³€í™˜)
  â†“ (3-Layer êµ¬ì¡°ë¡œ í™”ë©´ ë Œë”ë§)
```

#### 5.3.2 ê²€ìƒ‰ í”Œë¡œìš°

```
searchTab.html (ê²€ìƒ‰)
  â†“ (í…ìŠ¤íŠ¸ ê²€ìƒ‰ ë˜ëŠ” ì´ë¯¸ì§€ ì—…ë¡œë“œ)
  â†“ (searchImages ë˜ëŠ” searchSimilar API í˜¸ì¶œ)
  â†“ (ê²°ê³¼ ê·¸ë¦¬ë“œ ë Œë”ë§)
filter.html (í•„í„° ì ìš©)
  â†“ (í•„í„° ì˜µì…˜ ì„ íƒ)
  â†“ (searchSimilar API ì¬í˜¸ì¶œ)
  â†“ (í•„í„°ë§ëœ ê²°ê³¼ í‘œì‹œ)
```

---

## 6. íƒœìŠ¤í¬ í”Œë¡œìš°

### 6.1 ì´ë¯¸ì§€ ì—…ë¡œë“œ â†’ ë¶„ì„ â†’ ê²°ê³¼ í‘œì‹œ í”Œë¡œìš°

```
[ì‚¬ìš©ì ì•¡ì…˜]
1. index.html ì ‘ì†
2. ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒ (ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë˜ëŠ” íŒŒì¼ ì„ íƒ)
3. í”„ë¡¬í”„íŠ¸ ì…ë ¥ (ì„ íƒì‚¬í•­)
4. ë¶„ì„ ì‹œì‘ ë²„íŠ¼ í´ë¦­

[ì‹œìŠ¤í…œ ì²˜ë¦¬]
5. íŒŒì¼ì„ base64ë¡œ ë³€í™˜
6. analyzeDesign Cloud Function í˜¸ì¶œ
   - Firebase Storageì— ì´ë¯¸ì§€ ì—…ë¡œë“œ
   - Gemini Vision APIë¡œ 3-Layer ë¶„ì„ ìˆ˜í–‰
   - multimodalembedding@001ë¡œ ì´ë¯¸ì§€ ì„ë² ë”© ìƒì„±
   - Firestoreì— AnalysisDocument ì €ì¥
   - (Optional) BigQueryì— ë©”íŠ¸ë¦­ ì €ì¥
7. analysisIdë¥¼ localStorageì— ì €ì¥
8. analyze.htmlë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (analysisId íŒŒë¼ë¯¸í„° í¬í•¨)

[ê²°ê³¼ í‘œì‹œ]
9. analyze.htmlì—ì„œ analysisId ì½ê¸°
10. getAnalysis API í˜¸ì¶œ
11. dataAdapter.jsë¡œ ë°ì´í„° ë³€í™˜ (Firestore â†’ í”„ë¡ íŠ¸ì—”ë“œ í˜•ì‹)
12. 3-Layer êµ¬ì¡°ë¡œ í™”ë©´ ë Œë”ë§:
    - Layer 1: Performance & Information (50%)
    - Layer 2: Form & Aesthetic (30%)
    - Layer 3: Communicative Impact (20%)
13. ìƒ‰ìƒ íŒ”ë ˆíŠ¸, í‚¤ì›Œë“œ, í™œìš© ì œì•ˆ í‘œì‹œ
```

### 6.2 ê²€ìƒ‰ â†’ í•„í„° â†’ ê²°ê³¼ í‘œì‹œ í”Œë¡œìš°

```
[ì‚¬ìš©ì ì•¡ì…˜]
1. searchTab.html ì ‘ì†
2. ê²€ìƒ‰ ë°©ë²• ì„ íƒ:
   a. í…ìŠ¤íŠ¸ ê²€ìƒ‰: ê²€ìƒ‰ì–´ ì…ë ¥ â†’ searchImages API í˜¸ì¶œ
   b. ì´ë¯¸ì§€ ê²€ìƒ‰: ì´ë¯¸ì§€ ì—…ë¡œë“œ â†’ analyzeDesign â†’ searchSimilar API í˜¸ì¶œ

[ì‹œìŠ¤í…œ ì²˜ë¦¬]
3a. í…ìŠ¤íŠ¸ ê²€ìƒ‰:
   - Google Custom Search API í˜¸ì¶œ
   - ê²°ê³¼ ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
3b. ì´ë¯¸ì§€ ê²€ìƒ‰:
   - ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° analyzeDesign ìˆ˜í–‰
   - imageEmbedding ì¶”ì¶œ
   - Firestore Vector Search ìˆ˜í–‰ (findNearest)
   - ìœ ì‚¬ ë””ìì¸ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜

[í•„í„° ì ìš©]
4. filter.htmlë¡œ ì´ë™
5. í•„í„° ì˜µì…˜ ì„ íƒ:
   - í¬ë§· (UX_UI, Editorial, Poster ë“±)
   - fixScope (StructureRebuild, DetailTuning)
   - ì ìˆ˜ ë²”ìœ„ (overallScore)
6. searchSimilar API ì¬í˜¸ì¶œ (í•„í„° íŒŒë¼ë¯¸í„° í¬í•¨)

[ê²°ê³¼ í‘œì‹œ]
7. í•„í„°ë§ëœ ê²°ê³¼ ê·¸ë¦¬ë“œ ë Œë”ë§
8. ê° ê²°ê³¼ í•­ëª©:
   - ì¸ë„¤ì¼ ì´ë¯¸ì§€
   - ìœ ì‚¬ë„ ì ìˆ˜
   - í¬ë§·, fixScope í‘œì‹œ
   - ë‹¤ìš´ë¡œë“œ/ê³µìœ  ë²„íŠ¼
```

### 6.3 ë§ˆì´í˜ì´ì§€ â†’ í”„ë¡œí•„ ê´€ë¦¬ í”Œë¡œìš°

```
[ì‚¬ìš©ì ì•¡ì…˜]
1. mypage.html ì ‘ì†
2. í”„ë¡œí•„ ì •ë³´ í™•ì¸/ìˆ˜ì •

[ì‹œìŠ¤í…œ ì²˜ë¦¬]
3. getUserProfile API í˜¸ì¶œ
   - Firestore users/{uid} ì¡°íšŒ
   - ì‚¬ìš©ì í”„ë¡œí•„ ì •ë³´ ë°˜í™˜
4. getAnalyses API í˜¸ì¶œ
   - Firestore analyses ì»¬ë ‰ì…˜ ì¿¼ë¦¬ (userId í•„í„°)
   - ë¶„ì„ íˆìŠ¤í† ë¦¬ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜

[í™”ë©´ í‘œì‹œ]
5. í”„ë¡œí•„ ì„¹ì…˜:
   - í”„ë¡œí•„ ì´ë¯¸ì§€
   - ë‹‰ë„¤ì„, ì´ë©”ì¼
   - êµ¬ë… ì •ë³´
6. ë¶„ì„ íˆìŠ¤í† ë¦¬ ì„¹ì…˜:
   - ìµœê·¼ ë¶„ì„ ëª©ë¡ (ê·¸ë¦¬ë“œ/ë¦¬ìŠ¤íŠ¸ ë·°)
   - ê° ë¶„ì„ í•­ëª©:
     * ì¸ë„¤ì¼ ì´ë¯¸ì§€
     * íŒŒì¼ëª…
     * ë¶„ì„ ì¼ì‹œ
     * ì „ì²´ ì ìˆ˜ (overallScore)
     * fixScope í‘œì‹œ
```

---

## 7. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 7.1 ë¶„ì„ íŒŒì´í”„ë¼ì¸ (Vision â†’ Metrics â†’ Vector)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: Image Upload                                            â”‚
â”‚  - Client sends base64 image + metadata                          â”‚
â”‚  - Function uploads to Cloud Storage                             â”‚
â”‚  - Returns imageUrl                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: Vision Analysis                                         â”‚
â”‚  - Model: gemini-3-pro-preview                                  â”‚
â”‚  - Input: Image bytes + System Instruction                       â”‚
â”‚  - Output: DesignAnalysisResultLLM (snake_case, Pydantic)       â”‚
â”‚  - Validation: Pydantic model_validate_json()                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: Meta Diagnosis                                         â”‚
â”‚  - Rule-based fixScope computation                              â”‚
â”‚  - Validate against LLM-suggested fixScope                      â”‚
â”‚  - Log discrepancies for analysis                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: Embedding Generation                                   â”‚
â”‚  - Model: multimodalembedding@001                              â”‚
â”‚  - Input: Image bytes                                            â”‚
â”‚  - Output: float[512]                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: Data Persistence                                       â”‚
â”‚  - Firestore: AnalysisDocument (camelCase) + imageEmbedding      â”‚
â”‚  - BigQuery: DesignWorkRow + DesignMetricsRow (snake_case)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ì „ì²´ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            CLIENT LAYER (HTML/JS)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ index.html  â”‚  â”‚analyze.html â”‚  â”‚searchTab.htmlâ”‚  â”‚mypage.html â”‚        â”‚
â”‚  â”‚  (Upload)   â”‚  â”‚  (Report)   â”‚  â”‚  (Search)    â”‚  â”‚  (Profile)  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                â”‚                â”‚                â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                            â”‚                                                â”‚
â”‚                            â–¼                                                â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚         â”‚  services/firebaseService.js        â”‚                             â”‚
â”‚         â”‚  services/apiService.js             â”‚                             â”‚
â”‚         â”‚  utils/dataAdapter.js              â”‚                             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FIREBASE FUNCTIONS v2                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  analyzeDesign  â”‚  â”‚  chatWithMentor â”‚  â”‚  searchSimilar  â”‚             â”‚
â”‚  â”‚  (Vision + BQ) â”‚  â”‚  (RAG + Chat)   â”‚  â”‚  (Vector KNN)   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚  getAnalyses    â”‚  â”‚  getUserProfile â”‚                                  â”‚
â”‚  â”‚  (Query)        â”‚  â”‚  (Query)        â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚                    â”‚
            â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AI MODEL LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  gemini-3-pro-      â”‚  â”‚  gemini-2.5-flash   â”‚                 â”‚
â”‚  â”‚  preview (Vision)   â”‚  â”‚  (Chat/Tutor)       â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  multimodalembedding@001 (512-dim)          â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚                    â”‚
            â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATA LAYER                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Firestore (nam5 ë¦¬ì „) - Real-time + Vector Search         â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ analyses/{id}         (AnalysisDocument + embedding)   â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ chatSessions/{id}     (ChatSessionDocument)            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ bookmarks/{id}        (BookmarkDocument)               â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ collections/{id}      (CollectionDocument)             â”‚  â”‚
â”‚  â”‚  â””â”€â”€ users/{uid}           (UserDocument)                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Cloud Storage (asia-northeast3)                          â”‚  â”‚
â”‚  â”‚  â””â”€â”€ design-uploads/{uid}/{filename}                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  BigQuery (í–¥í›„) - Analytics + Historical                  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ design_work           (ë©”íƒ€ë°ì´í„°)                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ design_metrics        (Layer 1-3 ë©”íŠ¸ë¦­)                â”‚  â”‚
â”‚  â”‚  â””â”€â”€ ab_sessions/events    (A/B í…ŒìŠ¤íŠ¸)                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 3-Layer í‰ê°€ í”„ë ˆì„ì›Œí¬

dysappì˜ í•µì‹¬ í‰ê°€ ì²´ê³„. ì •ë³´ë””ìì¸ ì´ë¡ (Bauhaus, Swiss Style) ê¸°ë°˜.

| Layer | ì´ë¦„ | ê°€ì¤‘ì¹˜ | í‰ê°€ í•­ëª© |
|-------|------|--------|----------|
| **L1** | Performance & Information | 50% | hierarchyScore, scanabilityScore, goalClarityScore, accessibility |
| **L2** | Form & Aesthetic | 30% | gridConsistency, visualBalance, colorHarmony, typographyQuality |
| **L3** | Communicative Impact | 20% | trustVibe, engagementPotential, emotionalTone |

### 7.5 Vector Search Strategy A

v1ì—ì„œ í™•ì •ëœ Firestore Native Vector Search ì „ëµ.

| Criteria | Firestore Vector | Vertex AI Vector | Decision |
|----------|------------------|------------------|----------|
| Setup Complexity | Low (index only) | High (endpoint + index) | **Firestore** |
| Cost (< 100k docs) | Included in Firestore | Separate billing | **Firestore** |
| Real-time Sync | Native | Manual pipeline | **Firestore** |
| Filter + KNN | Supported | Supported | Tie |
| Latency | ~100-300ms | ~50-100ms | Acceptable |
| Scale Limit | ~1M vectors | 100M+ | Vertex for v3+ |

**ê²°ë¡ :** v1ì—ì„œëŠ” Firestore Vector Search. 100k ì´ìƒ ìŠ¤ì¼€ì¼ ì‹œ Vertex AI ë§ˆì´ê·¸ë ˆì´ì…˜ ê³ ë ¤ (v3+).

---

## 8. ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ ê°œìš”

### 8.1 Core Functions

#### FR-001: analyzeDesign
- **ëª©ì **: ì´ë¯¸ì§€ ë¶„ì„ ë° 3-Layer í‰ê°€
- **ì…ë ¥**: base64 ì´ë¯¸ì§€, mimeType, fileName
- **ì¶œë ¥**: AnalysisDocument (scores, fixScope, nextActions)
- **ëª¨ë¸**: gemini-3-pro-preview
- **íƒ€ì„ì•„ì›ƒ**: 300ì´ˆ
- **ë©”ëª¨ë¦¬**: 512MB

**í”Œë¡œìš°**:
```
1. Auth í™•ì¸
2. Storage ì—…ë¡œë“œ â†’ imageUrl
3. Gemini Vision ë¶„ì„ â†’ DesignAnalysisResultLLM (snake_case)
4. Pydantic ê²€ì¦
5. computeFixScope() ê²€ì¦/ì˜¤ë²„ë¼ì´ë“œ
6. multimodalembedding@001 â†’ imageEmbedding[512]
7. llmToFirestore() â†’ AnalysisDocument (camelCase)
8. Firestore ì €ì¥
9. (Optional) BigQuery ì €ì¥
```

#### FR-002: chatWithMentor
- **ëª©ì **: ë¶„ì„ ê²°ê³¼ ê¸°ë°˜ AI ë©˜í† ë§
- **ì…ë ¥**: analysisId, message, sessionId(optional)
- **ì¶œë ¥**: response, sessionId
- **ëª¨ë¸**: gemini-2.5-flash
- **íƒ€ì„ì•„ì›ƒ**: 120ì´ˆ
- **ë©”ëª¨ë¦¬**: 256MB

**í”Œë¡œìš°**:
```
1. Auth í™•ì¸
2. Firestoreì—ì„œ AnalysisDocument ë¡œë“œ
3. (Optional) Vector Searchë¡œ ìœ ì‚¬ ë””ìì¸ ê²€ìƒ‰
4. buildSystemInstruction() - fixScope ê¸°ë°˜ ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
5. Gemini 2.5 Flash ì‘ë‹µ ìƒì„±
6. chatSessionsì— ì €ì¥
```

#### FR-003: searchSimilar
- **ëª©ì **: ìœ ì‚¬ ë””ìì¸ ë²¡í„° ê²€ìƒ‰
- **ì…ë ¥**: analysisId, limit, filterFormat, filterFixScope
- **ì¶œë ¥**: similar designs array
- **ì¸ë±ìŠ¤**: Firestore Vector Index (512-dim, COSINE)
- **íƒ€ì„ì•„ì›ƒ**: 60ì´ˆ
- **ë©”ëª¨ë¦¬**: 256MB

#### FR-004: getAnalyses
- **ëª©ì **: ì‚¬ìš©ì ë¶„ì„ ëª©ë¡ ì¡°íšŒ
- **ì…ë ¥**: userId, limit, offset
- **ì¶œë ¥**: analyses array

#### FR-005: getUserProfile
- **ëª©ì **: ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ
- **ì…ë ¥**: userId
- **ì¶œë ¥**: UserDocument

### 8.2 Query Patterns

Vector Searchë¥¼ ìœ„í•œ Firestore ì¿¼ë¦¬ íŒ¨í„´:

```typescript
// Pattern 1: User-scoped similar designs
db.collection("analyses")
  .where("userId", "==", uid)
  .findNearest({
    vectorField: "imageEmbedding",
    queryVector: targetEmbedding,
    limit: 20,
    distanceMeasure: "COSINE"
  })

// Pattern 2: Format-filtered reference search
db.collection("analyses")
  .where("formatPrediction", "==", "Thumbnail")
  .where("overallScore", ">=", 70)
  .findNearest({
    vectorField: "imageEmbedding",
    queryVector: targetEmbedding,
    limit: 10,
    distanceMeasure: "COSINE"
  })

// Pattern 3: FixScope-aware examples
db.collection("analyses")
  .where("fixScope", "==", "StructureRebuild")
  .findNearest({
    vectorField: "imageEmbedding",
    queryVector: targetEmbedding,
    limit: 5,
    distanceMeasure: "COSINE"
  })
```

---

## 9. ì±—ë´‡ ë ˆì´ì–´ ë° ìš°ì„ ìˆœìœ„ ê·œì¹™

### 9.1 Layer ì •ì˜

dysapp ì±—ë´‡ì€ ë¶„ì„ ê²°ê³¼ì˜ **fixScope**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ë‹µ ìš°ì„ ìˆœìœ„ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.

#### Layer 1: Performance & Information (êµ¬ì¡° ë ˆì´ì–´) - 50%

| ë©”íŠ¸ë¦­ | ì„¤ëª… | ì ìˆ˜ ë²”ìœ„ |
|--------|------|----------|
| `hierarchyScore` | ì‹œê°ì  ê³„ì¸µ ëª…í™•ì„± (í—¤ë“œë¼ì¸-ë³¸ë¬¸-CTA ëŒ€ë¹„) | 0-100 |
| `scanabilityScore` | ì •ë³´ ê·¸ë£¹í•‘ ë° ìŠ¤ìº” ì†ë„ | 0-100 |
| `goalClarityScore` | ì£¼ì œ/í–‰ë™ ìœ ë„ ëª…í™•ì„± | 0-100 |
| `accessibility.lowContrast` | WCAG AA ê¸°ì¤€ ëŒ€ë¹„ ë¯¸ë‹¬ | boolean |
| `accessibility.tinyText` | í…ìŠ¤íŠ¸ í¬ê¸° (<12px) | boolean |
| `accessibility.cluttered` | ì •ë³´ ê³¼ë°€ | boolean |
| `diagnosisSummary` | êµ¬ì¡°ì  ë¬¸ì œ í•œ ì¤„ ìš”ì•½ | string |

#### Layer 2: Form & Aesthetic (ë¯¸ì  ë ˆì´ì–´) - 30%

| ë©”íŠ¸ë¦­ | ì„¤ëª… | ì ìˆ˜ ë²”ìœ„ |
|--------|------|----------|
| `gridConsistency` | ê·¸ë¦¬ë“œ ì •ë ¬ ì •í™•ë„ | 0-100 |
| `visualBalance` | ì‹œê°ì  ê· í˜• (ë¹„ëŒ€ì¹­/ëŒ€ì¹­) | 0-100 |
| `colorHarmony` | ìƒ‰ìƒ ì´ë¡  ì¤€ìˆ˜ | 0-100 |
| `typographyQuality` | íƒ€ì´í¬ê·¸ë˜í”¼ í’ˆì§ˆ | 0-100 |

#### Layer 3: Communicative Impact (ì†Œí†µ ë ˆì´ì–´) - 20%

| ë©”íŠ¸ë¦­ | ì„¤ëª… | ê°’ |
|--------|------|-----|
| `trustVibe` | ì „ë¬¸ì„±/ì‹ ë¢°ë„ ì¸ìƒ | High / Medium / Low |
| `engagementPotential` | í–‰ë™ ìœ ë„ ê°€ëŠ¥ì„± | High / Medium / Low |
| `emotionalTone` | ê°ì„±ì  ë¶„ìœ„ê¸° | Calm / Energetic / Serious / Playful / Minimal |

### 9.2 ìš°ì„ ìˆœìœ„ ê·œì¹™ (FixScope Decision)

**í•µì‹¬ ì›ì¹™:** Layer 1ì´ ê¸°ì¤€ ë¯¸ë‹¬ì´ë©´ Layer 2-3 ê°œì„ ì€ ì˜ë¯¸ ì—†ìŒ

```typescript
function computeFixScope(
  l1: PerformanceMetrics,
  l2: FormMetrics
): "StructureRebuild" | "DetailTuning" {

  // Rule 1: Critical structural failure (ìµœìš°ì„ )
  // â†’ Layer 1 í•µì‹¬ ì§€í‘œê°€ 50 ë¯¸ë§Œì´ë©´ ë¬´ì¡°ê±´ êµ¬ì¡° ì¬ì„¤ê³„
  if (l1.hierarchyScore < 50 || l1.goalClarityScore < 50) {
    return "StructureRebuild";
  }

  // Rule 2: Scanability failure (ë†’ì€ ìš°ì„ ìˆœìœ„)
  // â†’ ì •ë³´ êµ¬ì¡°í™”ì— ì‹¤íŒ¨í•˜ë©´ êµ¬ì¡° ì¬ì„¤ê³„
  if (l1.scanabilityScore < 50) {
    return "StructureRebuild";
  }

  // Rule 3: Structure OK, form needs work
  // â†’ êµ¬ì¡°ëŠ” ê´œì°®ì§€ë§Œ ê·¸ë¦¬ë“œê°€ ì•½í•˜ë©´ ë””í…Œì¼ íŠœë‹
  if (l1.hierarchyScore >= 60 && l2.gridConsistency < 80) {
    return "DetailTuning";
  }

  // Rule 4: Ambiguous case (50-60 range)
  // â†’ ì• ë§¤í•œ ê²½ìš°ëŠ” ì•ˆì „í•˜ê²Œ êµ¬ì¡° ì¬ì„¤ê³„ë¡œ ë¶„ë¥˜
  if (l1.hierarchyScore >= 50 && l1.hierarchyScore < 60) {
    return "StructureRebuild";
  }

  return "DetailTuning";
}
```

### 9.3 ì˜ˆì™¸ ì¡°ê±´

| ì¡°ê±´ | fixScope | ì„¤ëª… |
|------|----------|------|
| `hierarchyScore < 50` | StructureRebuild | í¬ì»¬í¬ì¸íŠ¸ ë¶€ì¬ |
| `goalClarityScore < 50` | StructureRebuild | ëª©ì  ë¶ˆëª…í™• |
| `scanabilityScore < 50` | StructureRebuild | ì •ë³´ êµ¬ì¡° ì‹¤íŒ¨ |
| `50 <= hierarchyScore < 60` | StructureRebuild | ê²½ê³„ê°’ì€ ë³´ìˆ˜ì  íŒë‹¨ |
| `hierarchyScore >= 60 && gridConsistency < 80` | DetailTuning | êµ¬ì¡° OK, ë¯¸ì  ë³´ì™„ í•„ìš” |
| `accessibility í”Œë˜ê·¸ 3ê°œ ì¤‘ 2ê°œ ì´ìƒ true` | StructureRebuild | ì ‘ê·¼ì„± ì‹¬ê° |

### 9.4 ì±—ë´‡ ì‘ë‹µ ìš°ì„ ìˆœìœ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    fixScope = "StructureRebuild"              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì‘ë‹µ í¬ë§·:                                                    â”‚
â”‚  1. "í˜„ì¬ ë””ìì¸ì€ 'êµ¬ì¡° ì¬ì„¤ê³„'ê°€ í•„ìš”í•©ë‹ˆë‹¤."                 â”‚
â”‚  2. Layer 1 ë¬¸ì œì  êµ¬ì²´ ì§„ë‹¨ (diagnosisSummary í™œìš©)           â”‚
â”‚  3. êµ¬ì¡° ê°œì„  ì•¡ì…˜ 3ê°€ì§€ (nextActionsì—ì„œ L1 ê´€ë ¨ë§Œ í•„í„°ë§)    â”‚
â”‚  4. "êµ¬ì¡°ê°€ ê°œì„ ë˜ë©´ Layer 2 ë¯¸ì  ìš”ì†Œë¥¼ ë‹¤ë“¬ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."  â”‚
â”‚                                                               â”‚
â”‚  ì ˆëŒ€ ê¸ˆì§€:                                                    â”‚
â”‚  - Layer 2-3 ê°œì„  ì œì•ˆ (ìƒ‰ìƒ, í°íŠ¸ ë“±)                         â”‚
â”‚  - "ì˜ˆì˜ê²Œ" ë¥˜ì˜ í‘œí˜„ì  ì¡°ì–¸                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    fixScope = "DetailTuning"                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì‘ë‹µ í¬ë§·:                                                    â”‚
â”‚  1. "í˜„ì¬ ë””ìì¸ì˜ êµ¬ì¡°ëŠ” ì•ˆì •ì ì…ë‹ˆë‹¤. 'ë””í…Œì¼ íŠœë‹'ì„..."    â”‚
â”‚  2. Layer 2 ê°œì„  í¬ì¸íŠ¸ (grid, balance, color, typography)    â”‚
â”‚  3. Layer 3 ì¸ìƒ ê°œì„  ì œì•ˆ (trust, engagement ê´€ì )           â”‚
â”‚  4. êµ¬ì²´ì  ìˆ˜ì¹˜ ê¸°ë°˜ ì¡°ì–¸ (ì˜ˆ: "ì—¬ë°±ì„ 20% ë” í™•ë³´í•˜ì„¸ìš”")     â”‚
â”‚                                                               â”‚
â”‚  í—ˆìš©:                                                         â”‚
â”‚  - ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ì¡°ì • ì œì•ˆ                                       â”‚
â”‚  - íƒ€ì´í¬ê·¸ë˜í”¼ ê°œì„  ì œì•ˆ                                      â”‚
â”‚  - ê°ì„±ì  í†¤ ì¡°ì • ì œì•ˆ                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. ì±—ë´‡ ë°±ì—”ë“œ í”„ë ˆì„ì›Œí¬ ë° í”Œë¡œìš°

### 10.1 System Instruction í…œí”Œë¦¿

```typescript
const buildSystemInstruction = (analysis: AnalysisDocument): string => `
You are dysapp's AI Design Tutor.

Current Design Analysis:
- Format: ${analysis.formatPrediction}
- Layer 1 (Structure): hierarchy=${analysis.layer1Metrics.hierarchyScore}, scanability=${analysis.layer1Metrics.scanabilityScore}, goalClarity=${analysis.layer1Metrics.goalClarityScore}
- Layer 2 (Form): grid=${analysis.layer2Metrics.gridConsistency}, balance=${analysis.layer2Metrics.visualBalance}, color=${analysis.layer2Metrics.colorHarmony}, typography=${analysis.layer2Metrics.typographyQuality}
- Layer 3 (Impact): trust=${analysis.layer3Metrics.trustVibe}, engagement=${analysis.layer3Metrics.engagementPotential}, tone=${analysis.layer3Metrics.emotionalTone}
- Overall Score: ${analysis.overallScore}
- FixScope: ${analysis.fixScope}
- Diagnosis: ${analysis.layer1Metrics.diagnosisSummary}

Response Guidelines:
1. ë¨¼ì € "${analysis.fixScope === 'StructureRebuild' ? 'êµ¬ì¡° ì¬ì„¤ê³„' : 'ë””í…Œì¼ íŠœë‹'}"ê°€ ìš°ì„ ì„ì„ ëª…ì‹œí•˜ì„¸ìš”.
2. ì‚¬ìš©ìê°€ ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ìˆ˜ì • ì œì•ˆ 3ê°€ì§€ë¥¼ ë‹¨ê³„ë³„ë¡œ ì œì‹œí•˜ì„¸ìš”.
3. ê° ì œì•ˆì—ëŠ” "ì™œ" ê·¸ë ‡ê²Œ í•´ì•¼ í•˜ëŠ”ì§€ Layer 1-3 ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•˜ì„¸ìš”.
4. í•­ìƒ í•œêµ­ì–´(ì¡´ëŒ“ë§)ë¡œ ë‹µë³€í•˜ì„¸ìš”.
5. ê°„ê²°í•˜ê³  ëª…í™•í•˜ê²Œ ë‹µë³€í•˜ì„¸ìš”. ë¶ˆí•„ìš”í•œ ì„œë¡ ì€ ìƒëµí•˜ì„¸ìš”.
`;
```

### 10.2 ì±—ë´‡ í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: Load Analysis Context                                   â”‚
â”‚  - Fetch AnalysisDocument from Firestore                         â”‚
â”‚  - Extract layer1/2/3 Metrics, fixScope, nextActions             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: Vector Search (Optional RAG)                            â”‚
â”‚  - Query: imageEmbedding of current design                       â”‚
â”‚  - Find similar designs with high scores                         â”‚
â”‚  - Use as positive examples in context                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: Build System Instruction                                â”‚
â”‚  - Include layer metrics summary                                 â”‚
â”‚  - Include fixScope (StructureRebuild vs DetailTuning)           â”‚
â”‚  - Include user question                                         â”‚
â”‚  - Include similar design references (if found)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: Generate Response                                       â”‚
â”‚  - Model: gemini-2.5-flash                                       â”‚
â”‚  - Config: temperature=0.7, topP=0.9, maxOutputTokens=2048       â”‚
â”‚  - Priority: fixScope-aware advice                               â”‚
â”‚  - Format: êµ¬ì¡°/ë””í…Œì¼ ìš°ì„ ìˆœìœ„ ëª…ì‹œ + êµ¬ì²´ ì•¡ì…˜ 3ê°œ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: Save & Return                                           â”‚
â”‚  - Save to chatSessions/{sessionId}/messages                     â”‚
â”‚  - Return response to client                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.3 Generation Config

```typescript
// Vision ë¶„ì„ìš© (ë‚®ì€ temperature = ì¼ê´€ì„±)
export const VISION_CONFIG = {
  temperature: 0.2,
  topP: 0.95,
  topK: 40,
  maxOutputTokens: 8192,
};

// ì±—ë´‡ìš© (ë†’ì€ temperature = ìì—°ìŠ¤ëŸ¬ì›€)
export const CHAT_CONFIG = {
  temperature: 0.7,
  topP: 0.9,
  maxOutputTokens: 2048,
};
```

### 10.4 ì—ëŸ¬ ì²˜ë¦¬

| ì—ëŸ¬ íƒ€ì… | ì›ì¸ | ëŒ€ì‘ |
|----------|------|------|
| `unauthenticated` | ì¸ì¦ ì—†ìŒ | ìµëª… ì¸ì¦ ìë™ ì‹¤í–‰ |
| `not-found` | analysisId ì—†ìŒ | ë¶„ì„ ë¨¼ì € ìˆ˜í–‰ ì•ˆë‚´ |
| `permission-denied` | íƒ€ì¸ì˜ ë¶„ì„ ì ‘ê·¼ | ê¶Œí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ |
| `resource-exhausted` | API í• ë‹¹ëŸ‰ ì´ˆê³¼ | ì ì‹œ í›„ ì¬ì‹œë„ ì•ˆë‚´ |
| `internal` | ì„œë²„ ì˜¤ë¥˜ | ì¼ë°˜ ì˜¤ë¥˜ ë©”ì‹œì§€ + ë¡œê¹… |

---

## 11. ë°ì´í„° ì „ëµ

### 11.1 Ontology êµ¬ì¡°

#### 5ëŒ€ í•µì‹¬ ì—”í‹°í‹° ë° ê´€ê³„ ê·¸ë˜í”„

```
DesignWork â€”[APPLIES]â†’ DesignGuideline
DesignWork â€”[SUITABLE_FOR]â†’ CurriculumUnit
DesignGuideline â€”[SUPPORTED_BY]â†’ AcademicResource
DesignGuideline â€”[TAUGHT_IN]â†’ CurriculumUnit
CurriculumUnit â€”[COVERS]â†’ DesignGuideline
AcademicResource â€”[CITES]â†’ AcademicResource (ë…¼ë¬¸ ê°„ ì¸ìš©)
```

| Entity | Firestore | BigQuery | ìš©ë„ |
|--------|-----------|----------|------|
| DesignWork + Metrics | `analyses/{id}` | `design_work` + `design_metrics` | ë¶„ì„ ê²°ê³¼ |
| DesignGuideline | (v2: `guidelines`) | `ref_theory_nodes` | RAG ì§€ì‹ |
| AcademicResource | (v2: `resources`) | `academic_resources` | í•™ìˆ  ê·¼ê±° |
| CurriculumUnit | (v2: `curricula`) | `curriculum_units` | í•™ìŠµ ê²½ë¡œ |
| IndustryStat | - | `industry_stats` | ì‚°ì—… í†µê³„ |

#### ì—”í‹°í‹° ìŠ¤í‚¤ë§ˆ ìƒì„¸

**1. DesignWork (schema.org `VisualArtwork` í™•ì¥)**

ë””ìì¸ ì‘ì—…ë¬¼ í•œ ê°œì²´. ë¶„ì„Â·í‰ê°€Â·íŠœí„°ë§ì˜ ì¤‘ì‹¬ ëŒ€ìƒ.

```typescript
DesignWork {
  // ê¸°ë³¸ ë©”íƒ€ë°ì´í„° (schema.org í˜¸í™˜)
  id: string;                     // UUID or Firestore doc ID
  title?: string;
  description?: string;
  creator?: Person | Organization;
  createdAt: datetime;
  updatedAt: datetime;
  thumbnailUrl?: string;          // schema.org thumbnailUrl
  url?: string;                   // ì›ë³¸ ë§í¬
  inLanguage?: string;            // BCP47 (ko, en)

  // ë„ë©”ì¸/ë§¥ë½ ë¶„ë¥˜
  format: Enum(
    "UX_UI", "Editorial", "Poster", "Thumbnail", "Card", "BI_CI", "Unknown"
  );
  goalType?: Enum("Inform", "Persuade", "Click", "SignUp", "Purchase");
  targetAudience?: Enum("Student", "GeneralPublic", "Expert", "Teen", "Adult");
  platform?: Enum("Web", "Mobile", "YouTubeThumb", "SNSFeed", "OOH");

  // ë¶„ì„/í‰ê°€ ê²°ê³¼ (dysapp ê³ ìœ )
  layer1Metrics: PerformanceMetrics;
  layer2Metrics: FormMetrics;
  layer3Metrics: CommunicativeMetrics;
  overallScore: number;           // 0-100
  fixScope: Enum("StructureRebuild", "DetailTuning");

  // ë²¡í„° ê²€ìƒ‰ìš© (Strategy A: Firestore Vector Search)
  imageEmbedding?: float[512];    // multimodalembedding@001
  embeddingModel: string;         // "multimodalembedding@001"
  embeddingDim: number;           // 512
  embeddingVersion: number;       // ë²„ì „ ê´€ë¦¬ìš©
  analysisVersion: number;         // í”„ë¡¬í”„íŠ¸/ë©”íŠ¸ë¦­ ë²„ì „

  // ê´€ê³„
  appliesGuidelines: string[];    // DesignGuideline IDs
  suitableForCurricula: string[]; // CurriculumUnit IDs
}
```

**2. DesignGuideline (schema.org `CreativeWork` ê¸°ë°˜)**

ë””ìì¸ ì›ì¹™Â·ê°€ì´ë“œë¼ì¸. RAGì˜ í•µì‹¬ ì§€ì‹ ë‹¨ìœ„. (v2+)

```typescript
DesignGuideline {
  id: string;
  title: string;
  summary: string;                // RAG í…ìŠ¤íŠ¸ í•µì‹¬
  fullText?: string;              // ìƒì„¸ ì„¤ëª…
  layer: Enum("Layer1", "Layer2", "Layer3");
  domain: Enum("UX_UI", "Editorial", "Thumbnail", "BI_CI", "General");
  principles: string[];           // ["Contrast", "FocalPoint", "GridSystem"]
  sourceType: Enum("AcademicPaper", "Book", "Standard", "Article", "IndustryReport");
  sourceCitation: string;
  textEmbedding?: float[];        // v2+ for Knowledge Base RAG
  supportedBy: string[];          // AcademicResource IDs
  exampleWorks: string[];         // DesignWork IDs (ì˜ˆì‹œ)
  taughtIn: string[];             // CurriculumUnit IDs
}
```

**3. AcademicResource (ë…¼ë¬¸Â·ì—°êµ¬Â·ë³´ê³ ì„œ)**

í•™ìˆ  ì§€ì‹ ë² ì´ìŠ¤. DesignGuidelineì˜ ê·¼ê±°. (v2+)

```typescript
AcademicResource {
  id: string;
  type: Enum("JournalArticle", "ConferencePaper", "Thesis", "Report", "Book");
  title: string;
  abstract: string;
  authors: string[];
  year: number;
  publisher?: string;
  doi?: string;
  url: string;
  tags: string[];                 // ["visual hierarchy", "Gestalt", "CTR"]
  researchArea: Enum("InformationDesign", "HCI", "CognitiveScience", "VisualCommunication", "Typography");
  textEmbedding?: float[];        // v2+ for Knowledge Base RAG
  supportsGuidelines: string[];   // DesignGuideline IDs
}
```

**4. CurriculumUnit (êµìœ¡ ë‹¨ìœ„)**

ëŒ€í•™Â·ê¸°ê´€ì˜ ê°•ì˜/ê³¼ì • ë‹¨ìœ„. íŠœí„°ë§ì˜ í•™ìŠµ ê²½ë¡œ ì œì•ˆìš©. (v2+)

```typescript
CurriculumUnit {
  id: string;
  title: string;
  description: string;
  level: Enum("Intro", "Intermediate", "Advanced");
  durationHours: number;
  institution: string;            // "í™ìµëŒ€", "KIDP"
  instructorName?: string;
  topics: string[];
  relatedGuidelines: string[];    // DesignGuideline IDs
  includesWorks: string[];        // DesignWork IDs (ê³¼ì œ/ì˜ˆì‹œ)
}
```

**5. IndustryStat (ì‚°ì—… í†µê³„)**

ë””ìì¸ íšŒì‚¬Â·ì‹œì¥ í†µê³„. ë§¥ë½/íŠ¸ë Œë“œ ì„¤ëª…ìš©. (v2+)

```typescript
IndustryStat {
  id: string;
  title: string;
  year: number;
  dataSource: string;             // "KIDP ì‚°ì—…í†µê³„", "data.go.kr"
  metrics: {
    totalCompanies?: number;
    avgRevenue?: number;
    domainBreakdown?: { [domain: string]: number };
  };
  tags: string[];
  textEmbedding?: float[];        // v2+ optional
}
```

### 11.2 í•„ë“œ ë„¤ì´ë° ì»¨ë²¤ì…˜

| Layer | Case Style | Example | Usage |
|-------|------------|---------|-------|
| **LLM Output** | `snake_case` | `hierarchy_score` | Gemini response |
| **Firestore** | `camelCase` | `hierarchyScore` | AnalysisDocument |
| **BigQuery** | `snake_case` | `layer1_hierarchy_score` | design_metrics |

### 11.3 í•„ë“œ ë§¤í•‘ í…Œì´ë¸”

#### Layer 1: Performance Metrics

| LLM Output | Firestore | BigQuery |
|------------|-----------|----------|
| `hierarchy_score` | `hierarchyScore` | `layer1_hierarchy_score` |
| `scanability_score` | `scanabilityScore` | `layer1_scanability_score` |
| `goal_clarity_score` | `goalClarityScore` | `layer1_goal_clarity_score` |
| `accessibility.low_contrast` | `accessibility.lowContrast` | `layer1_accessibility_low_contrast` |
| `diagnosis_summary` | `diagnosisSummary` | `layer1_diagnosis_summary` |

#### Layer 2: Form Metrics

| LLM Output | Firestore | BigQuery |
|------------|-----------|----------|
| `grid_consistency` | `gridConsistency` | `layer2_grid_consistency` |
| `visual_balance` | `visualBalance` | `layer2_visual_balance` |
| `color_harmony` | `colorHarmony` | `layer2_color_harmony` |
| `typography_quality` | `typographyQuality` | `layer2_typography_quality` |

#### Layer 3: Communicative Metrics

| LLM Output | Firestore | BigQuery |
|------------|-----------|----------|
| `trust_vibe` | `trustVibe` | `layer3_trust_vibe` |
| `engagement_potential` | `engagementPotential` | `layer3_engagement_potential` |
| `emotional_tone` | `emotionalTone` | `layer3_emotional_tone` |

### 11.4 Firestore Index ìš”êµ¬ì‚¬í•­

#### Composite Indexes

```json
{
  "indexes": [
    {
      "collectionGroup": "analyses",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "userId", "order": "ASCENDING" },
        { "fieldPath": "createdAt", "order": "DESCENDING" }
      ]
    },
    {
      "collectionGroup": "analyses",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "userId", "order": "ASCENDING" },
        { "fieldPath": "formatPrediction", "order": "ASCENDING" }
      ]
    }
  ]
}
```

#### Vector Index

```json
{
  "fieldOverrides": [
    {
      "collectionGroup": "analyses",
      "fieldPath": "imageEmbedding",
      "indexes": [
        {
          "dimensions": 512,
          "flat": {},
          "queryScope": "COLLECTION"
        }
      ]
    }
  ]
}
```

### 11.5 Firestore ìŠ¤í‚¤ë§ˆ ìƒì„¸ (AnalysisDocument)

**LLM ì¶œë ¥ ëª¨ë¸ (DesignAnalysisResultLLM) - snake_case**

```python
class DesignAnalysisResultLLM(BaseModel):
    format_prediction: Literal["UX_UI", "Editorial", "Poster", "Thumbnail", "Card", "BI_CI", "Unknown"]
    layer1_performance: PerformanceMetricsLLM
    layer2_form: FormMetricsLLM
    layer3_communicative: CommunicativeMetricsLLM
    overall_score: int  # 0-100
    fix_scope: Literal["StructureRebuild", "DetailTuning"]
    color_palette: List[ColorItemLLM]
    detected_keywords: List[str]
    rag_search_queries: List[str]
    next_actions: List[str]
```

**Firestore ë¬¸ì„œ ëª¨ë¸ (AnalysisDocument) - camelCase**

```typescript
interface AnalysisDocument {
  // ë©”íƒ€ë°ì´í„°
  userId: string;
  fileName: string;
  imageUrl: string;
  createdAt: Timestamp;
  updatedAt: Timestamp;
  lastAnalyzedAt: Timestamp;

  // ë¶„ë¥˜
  formatPrediction: "UX_UI" | "Editorial" | "Poster" | "Thumbnail" | "Card" | "BI_CI" | "Unknown";

  // 3-Layer ë©”íŠ¸ë¦­
  layer1Metrics: {
    hierarchyScore: number;        // 0-100
    scanabilityScore: number;      // 0-100
    goalClarityScore: number;      // 0-100
    accessibility: {
      lowContrast: boolean;
      tinyText: boolean;
      cluttered: boolean;
    };
    diagnosisSummary: string;
  };
  layer2Metrics: {
    gridConsistency: number;       // 0-100
    visualBalance: number;         // 0-100
    colorHarmony: number;           // 0-100
    typographyQuality: number;      // 0-100
  };
  layer3Metrics: {
    trustVibe: "High" | "Medium" | "Low";
    engagementPotential: "High" | "Medium" | "Low";
    emotionalTone: "Calm" | "Energetic" | "Serious" | "Playful" | "Minimal";
  };

  // ì¢…í•© í‰ê°€
  overallScore: number;            // 0-100
  fixScope: "StructureRebuild" | "DetailTuning";

  // ì¶”ì¶œëœ íŠ¹ì§•
  colorPalette: Array<{
    hex: string;
    approxName: string;
    usageRatio: number;            // 0.0-1.0
  }>;
  detectedKeywords: string[];
  ragSearchQueries: string[];
  nextActions: string[];

  // Vector Search (Strategy A)
  imageEmbedding?: number[];       // 512-dim
  embeddingModel: string;           // "multimodalembedding@001"
  embeddingDim: number;             // 512
  embeddingVersion: number;        // 1
  analysisVersion: number;         // 1
}
```

### 11.6 BigQuery ìŠ¤í‚¤ë§ˆ ìƒì„¸

**design_work í…Œì´ë¸” (ë©”íƒ€ë°ì´í„°)**

```sql
CREATE TABLE `dysapp.design_work` (
  id STRING NOT NULL,                     -- Firestore analyses/{id}ì™€ ë™ì¼
  user_id STRING NOT NULL,
  file_name STRING,
  title STRING,
  description STRING,
  format STRING,                          -- UX_UI / Editorial / Poster / Thumbnail / Card / BI_CI / Unknown
  goal_type STRING,                       -- Inform / Persuade / Click / SignUp / Purchase
  target_audience STRING,                 -- Student / GeneralPublic / Expert / Teen / Adult
  platform STRING,                        -- Web / Mobile / YouTubeThumb / SNSFeed / OOH
  in_language STRING,                     -- ko, en, ...
  image_url STRING,
  created_at TIMESTAMP,
  updated_at TIMESTAMP,
  applies_guidelines ARRAY<STRING>,       -- DesignGuideline IDs
  suitable_for_curricula ARRAY<STRING>,   -- CurriculumUnit IDs
  analysis_version INT64,                 -- í”„ë¡¬í”„íŠ¸/ë©”íŠ¸ë¦­ ë²„ì „
  embedding_version INT64                  -- ì„ë² ë”© ëª¨ë¸ ë²„ì „
);
```

**design_metrics í…Œì´ë¸” (Layer 1-3 ë©”íŠ¸ë¦­)**

```sql
CREATE TABLE `dysapp.design_metrics` (
  id STRING NOT NULL,                     -- design_work.idì™€ 1:1
  analyzed_at TIMESTAMP,

  -- Layer 1: Performance & Information (50%)
  layer1_hierarchy_score INT64,
  layer1_scanability_score INT64,
  layer1_goal_clarity_score INT64,
  layer1_accessibility_low_contrast BOOL,
  layer1_accessibility_tiny_text BOOL,
  layer1_accessibility_cluttered BOOL,
  layer1_diagnosis_summary STRING,

  -- Layer 2: Form & Aesthetics (30%)
  layer2_grid_consistency INT64,
  layer2_visual_balance INT64,
  layer2_color_harmony INT64,
  layer2_typography_quality INT64,

  -- Layer 3: Communicative Impact (20%)
  layer3_trust_vibe STRING,               -- High / Medium / Low
  layer3_engagement_potential STRING,     -- High / Medium / Low
  layer3_emotional_tone STRING,           -- Calm / Energetic / Serious / Playful / Minimal

  -- Overall & Meta
  overall_score INT64,
  fix_scope STRING,                       -- StructureRebuild / DetailTuning

  -- Extracted Features
  color_palette ARRAY<STRUCT<
    hex STRING,
    approx_name STRING,
    usage_ratio FLOAT64
  >>,
  detected_keywords ARRAY<STRING>,
  rag_search_queries ARRAY<STRING>
);
```

### 11.7 ë²„ì „ ê´€ë¦¬

```typescript
interface VersionConfig {
  embeddingVersion: number;  // ì„ë² ë”© ëª¨ë¸ ë³€ê²½ ì‹œ ì¦ê°€
  embeddingModel: string;    // "multimodalembedding@001"
  embeddingDim: number;      // 512
  analysisVersion: number;   // í”„ë¡¬í”„íŠ¸/ë©”íŠ¸ë¦­ ë³€ê²½ ì‹œ ì¦ê°€
}

// v1 ê¸°ì¤€
const CURRENT_VERSION: VersionConfig = {
  embeddingVersion: 1,
  embeddingModel: "multimodalembedding@001",
  embeddingDim: 512,
  analysisVersion: 1,
};
```

### 11.8 ë°ì´í„° íë¦„ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER UPLOAD                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloud Function: analyzeDesign                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 1. Upload to Storage â†’ imageUrl                             â”‚â”‚
â”‚  â”‚ 2. Gemini 3 Pro Preview â†’ DesignAnalysisResultLLM           â”‚â”‚
â”‚  â”‚    (snake_case, Pydantic ê²€ì¦)                               â”‚â”‚
â”‚  â”‚ 3. Validate with Pydantic                                   â”‚â”‚
â”‚  â”‚ 4. Convert snake_case â†’ camelCase                           â”‚â”‚
â”‚  â”‚    (llmToFirestore() í•¨ìˆ˜)                                   â”‚â”‚
â”‚  â”‚ 5. Generate imageEmbedding (multimodalembedding@001)        â”‚â”‚
â”‚  â”‚ 6. Save to Firestore (AnalysisDocument)                     â”‚â”‚
â”‚  â”‚ 7. Insert to BigQuery (DesignWorkRow + DesignMetricsRow)    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Firestore: analyses/{id}                                        â”‚
â”‚  - AnalysisDocument (camelCase)                                  â”‚
â”‚  - imageEmbedding[512]                                           â”‚
â”‚  - Vector Index enabled                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloud Function:          â”‚   â”‚  BigQuery: dysapp dataset       â”‚
â”‚  chatWithMentor           â”‚   â”‚  - design_work                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚  - design_metrics              â”‚
â”‚  â”‚ 1. Load analysis doc  â”‚â”‚   â”‚  - ab_sessions/events         â”‚
â”‚  â”‚ 2. Vector search       â”‚â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚    (similar designs)  â”‚â”‚
â”‚  â”‚ 3. Build context      â”‚â”‚
â”‚  â”‚ 4. Gemini 2.5 Flash   â”‚â”‚
â”‚  â”‚ 5. Return response    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.9 LLM â†’ Firestore â†’ BigQuery ë³€í™˜ íë¦„

**ë³€í™˜ í•¨ìˆ˜ ì˜ˆì‹œ:**

```python
# LLM â†’ Firestore (snake_case â†’ camelCase)
def llm_to_firestore(llm_result: DesignAnalysisResultLLM) -> AnalysisDocument:
    return AnalysisDocument(
        formatPrediction=llm_result.format_prediction,
        layer1Metrics=PerformanceMetrics(
            hierarchyScore=llm_result.layer1_performance.hierarchy_score,
            scanabilityScore=llm_result.layer1_performance.scanability_score,
            goalClarityScore=llm_result.layer1_performance.goal_clarity_score,
            accessibility=AccessibilityFlags(
                lowContrast=llm_result.layer1_performance.accessibility.low_contrast,
                tinyText=llm_result.layer1_performance.accessibility.tiny_text,
                cluttered=llm_result.layer1_performance.accessibility.cluttered
            ),
            diagnosisSummary=llm_result.layer1_performance.diagnosis_summary
        ),
        # ... layer2, layer3, etc.
    )

# Firestore â†’ BigQuery (camelCase â†’ snake_case)
def firestore_to_bq(doc: AnalysisDocument) -> DesignMetricsRow:
    return DesignMetricsRow(
        id=doc.id,
        analyzedAt=doc.updatedAt,
        layer1_hierarchyScore=doc.layer1Metrics.hierarchyScore,
        layer1_scanabilityScore=doc.layer1Metrics.scanabilityScore,
        # ... etc.
    )
```

**ë°ì´í„° ë³€í™˜ ì²´ì¸:**

```
[LLM Output] DesignAnalysisResultLLM (snake_case)
  â†“ llmToFirestore()
[Firestore] AnalysisDocument (camelCase)
  â†“ firestoreToBQ()
[BigQuery] DesignWorkRow + DesignMetricsRow (snake_case)
```

---

## 12. ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„

### 12.1 BigQuery ë¶„ì„ í…Œì´ë¸” (í–¥í›„)

#### A/B í…ŒìŠ¤íŠ¸ ì„¸ì…˜

```sql
-- Note: BigQuery dataset nameì€ dysappìœ¼ë¡œ ë³€ê²½ í•„ìš”
CREATE TABLE `dysapp.ab_sessions` (
  session_id STRING NOT NULL,
  user_id STRING,
  variant STRING,                -- A / B / C
  started_at TIMESTAMP,
  ended_at TIMESTAMP,
  design_work_id STRING,
  fix_scope STRING,
  satisfaction_score INT64,      -- 1-5
  notes STRING
);
```

#### ì´ë²¤íŠ¸ ë¡œê·¸

```sql
CREATE TABLE `dysapp.ab_events` (
  session_id STRING,
  event_time TIMESTAMP,
  event_type STRING,             -- message_sent / suggestion_clicked / save_to_board
  payload JSON
);
```

### 12.2 í•µì‹¬ ëª¨ë‹ˆí„°ë§ ì§€í‘œ

| ì§€í‘œ | ì¿¼ë¦¬ | ëª©í‘œ |
|------|------|------|
| ë¶„ì„ ì„±ê³µë¥  | `success_count / total_count` | > 95% |
| í‰ê·  ë¶„ì„ ì‹œê°„ | `AVG(analysis_duration_ms)` | < 10,000 |
| ì±„íŒ… ì°¸ì—¬ìœ¨ | `chat_users / analysis_users` | > 30% |
| ì„¸ì…˜ë‹¹ ë©”ì‹œì§€ | `AVG(message_count)` | > 3 |
| ì¬ë°©ë¬¸ìœ¨ | `returning_users / total_users` | > 40% |

### 12.3 Vector Search í—¬ìŠ¤ì²´í¬

```typescript
async function vectorSearchHealthCheck(): Promise<{
  status: "ok" | "error";
  latency: number;
  indexedCount: number;
}> {
  const startTime = Date.now();

  try {
    const dummyVector = new Array(512).fill(0.1);
    const snapshot = await db.collection("analyses")
      .findNearest({
        vectorField: "imageEmbedding",
        queryVector: dummyVector,
        limit: 1,
        distanceMeasure: "COSINE"
      })
      .get();

    return {
      status: "ok",
      latency: Date.now() - startTime,
      indexedCount: snapshot.size,
    };
  } catch (error) {
    return {
      status: "error",
      latency: Date.now() - startTime,
      indexedCount: 0,
    };
  }
}
```

---

## 13. ë¦¬ìŠ¤í¬ ë° ëŒ€ì‘ ë°©ì•ˆ

### 13.1 ê¸°ìˆ  ë¦¬ìŠ¤í¬

| ë¦¬ìŠ¤í¬ | ì˜í–¥ | í™•ë¥  | ëŒ€ì‘ |
|--------|------|------|------|
| Gemini API ë¶ˆì•ˆì • | ë¶„ì„ ì‹¤íŒ¨ | ì¤‘ | Retry logic, fallback ëª¨ë¸ |
| Vector Index ë¹Œë“œ ì§€ì—° | ê²€ìƒ‰ ë¶ˆê°€ | ì € | ì¸ë±ìŠ¤ ì‚¬ì „ ë°°í¬ |
| Firestore í• ë‹¹ëŸ‰ ì´ˆê³¼ | ì„œë¹„ìŠ¤ ì¤‘ë‹¨ | ì € | ëª¨ë‹ˆí„°ë§ ì•ŒëŒ, ìë™ ìŠ¤ì¼€ì¼ë§ |
| ëŒ€ìš©ëŸ‰ ì´ë¯¸ì§€ ì²˜ë¦¬ | íƒ€ì„ì•„ì›ƒ | ì¤‘ | ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ, íƒ€ì„ì•„ì›ƒ ì—°ì¥ |

### 13.2 ë¹„ì¦ˆë‹ˆìŠ¤ ë¦¬ìŠ¤í¬

| ë¦¬ìŠ¤í¬ | ì˜í–¥ | í™•ë¥  | ëŒ€ì‘ |
|--------|------|------|------|
| ë¶„ì„ ì •í™•ë„ ë¶ˆë§Œì¡± | ì´íƒˆ ì¦ê°€ | ì¤‘ | ì „ë¬¸ê°€ í”¼ë“œë°± ë£¨í”„, í”„ë¡¬í”„íŠ¸ ê°œì„  |
| ê²½ìŸ ì„œë¹„ìŠ¤ ë“±ì¥ | ì ìœ ìœ¨ í•˜ë½ | ê³  | ì°¨ë³„í™” (êµìœ¡ ì—°ê³„, ì§€ì‹ë² ì´ìŠ¤) |
| API ë¹„ìš© ì´ˆê³¼ | ìˆ˜ìµì„± ì•…í™” | ì¤‘ | ì‚¬ìš©ëŸ‰ ì œí•œ, í”„ë¦¬ë¯¸ì—„ í”Œëœ |

### 13.3 ëŒ€ì‘ ìš°ì„ ìˆœìœ„

1. **P0 (ì¦‰ì‹œ)**: API ì¥ì•  ëŒ€ì‘, ë³´ì•ˆ ì·¨ì•½ì 
2. **P1 (24ì‹œê°„)**: ë¶„ì„ ì •í™•ë„ ì´ìŠˆ, ì„±ëŠ¥ ì €í•˜
3. **P2 (1ì£¼ì¼)**: UX ê°œì„  ìš”ì²­, ê¸°ëŠ¥ ë²„ê·¸
4. **P3 (ë°±ë¡œê·¸)**: ê¸°ëŠ¥ ì¶”ê°€ ìš”ì²­

---

## 14. ë¶€ë¡

### 14.1 íŒŒì¼ êµ¬ì¡°

```
C:\dysapp\dys_prototype\
â”œâ”€â”€ index.html              # ì—…ë¡œë“œ í˜ì´ì§€
â”œâ”€â”€ analyze.html            # ë¶„ì„ ê²°ê³¼ í˜ì´ì§€
â”œâ”€â”€ searchTab.html          # ê²€ìƒ‰ í˜ì´ì§€
â”œâ”€â”€ filter.html             # í•„í„° í˜ì´ì§€
â”œâ”€â”€ mypage.html             # ë§ˆì´í˜ì´ì§€ (ë¹„ì–´ìˆìŒ)
â”œâ”€â”€ search_detail_tab.html  # ê²€ìƒ‰ ìƒì„¸
â”œâ”€â”€ nav.html                # ë„¤ë¹„ê²Œì´ì…˜ ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ common.css              # ì „ì—­ ìŠ¤íƒ€ì¼
â”œâ”€â”€ includHTML.js            # HTML include ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ services/               # (ìƒì„± í•„ìš”)
â”‚   â”œâ”€â”€ firebaseService.js  # Firebase SDK ì´ˆê¸°í™”
â”‚   â””â”€â”€ apiService.js        # API í˜¸ì¶œ í•¨ìˆ˜ë“¤
â””â”€â”€ utils/                   # (ìƒì„± í•„ìš”)
    â””â”€â”€ dataAdapter.js       # ë°ì´í„° êµ¬ì¡° ë³€í™˜ ì–´ëŒ‘í„°
```

### 14.2 Enum ê°’ ì°¸ì¡°

#### formatPrediction / format

| Value | Description |
|-------|-------------|
| `UX_UI` | UX/UI ë””ìì¸ |
| `Editorial` | ì—ë””í† ë¦¬ì–¼/ì¶œíŒ ë””ìì¸ |
| `Poster` | í¬ìŠ¤í„° |
| `Thumbnail` | ì¸ë„¤ì¼ (YouTube ë“±) |
| `Card` | ì¹´ë“œ ë””ìì¸ |
| `BI_CI` | ë¸Œëœë“œ/CI ë””ìì¸ |
| `Unknown` | ë¶„ë¥˜ ë¶ˆê°€ |

#### fixScope / fix_scope

| Value | Condition | Description |
|-------|-----------|-------------|
| `StructureRebuild` | L1 avg < 60 | êµ¬ì¡°ì  ì¬ì„¤ê³„ í•„ìš” |
| `DetailTuning` | L1 avg >= 60 | ë””í…Œì¼ íŠœë‹ìœ¼ë¡œ ì¶©ë¶„ |

#### trustVibe / trust_vibe

| Value | Description |
|-------|-------------|
| `High` | ì „ë¬¸ì /ì‹ ë¢°ê° |
| `Medium` | ë³´í†µ |
| `Low` | ì•„ë§ˆì¶”ì–´/í˜¼ë€ìŠ¤ëŸ¬ì›€ |

#### emotionalTone / emotional_tone

| Value | Description |
|-------|-------------|
| `Calm` | ì°¨ë¶„í•œ |
| `Energetic` | ì—­ë™ì ì¸ |
| `Serious` | ì§„ì§€í•œ |
| `Playful` | ì¥ë‚œìŠ¤ëŸ¬ìš´ |
| `Minimal` | ë¯¸ë‹ˆë©€í•œ |

### 14.3 ë¬¸ì„œ ë²„ì „ ë§¤íŠ¸ë¦­ìŠ¤

| Document | Version | Last Updated | Status |
|----------|---------|--------------|--------|
| `dysapp_PRD.md` | 1.0 | 2025-01-27 | Initial Draft |
| `dysapp_FRD.md` | 1.0 | 2025-01-27 | Initial Draft |
| `dysapp_TSD.md` | 1.0 | 2025-01-27 | Initial Draft |
| `dysapp_SRD.md` | 1.0 | 2025-01-27 | Initial Draft |
| `dysapp_APISPEC.md` | 1.0 | 2025-01-27 | Initial Draft |
| `baseline_spec.md` (ì°¸ì¡°) | 1.0 | 2025-12-10 | Confirmed |
| `schima.md` (ì°¸ì¡°) | 2.0 | 2025-12-10 | Updated |
| `framework.md` (ì°¸ì¡°) | 2.0 | 2025-12-10 | Updated |

### 14.4 ì±—ë´‡ ê´€ë ¨ í™•ì • ë¬¸ì„œ ë§í¬

| ë¬¸ì„œ | ê²½ë¡œ | í•µì‹¬ ë‚´ìš© |
|------|------|----------|
| **Framework** | `docs/postdocs/framework.md` | ì±—ë´‡ íŒŒì´í”„ë¼ì¸ ì•„í‚¤í…ì²˜ |
| **Cloud Functions** | `docs/postdocs/cloudfunctions.md` | chatWithMentor êµ¬í˜„ ìƒì„¸ |
| **Vision Prompt** | `docs/postdocs/visionprompt.md` | 3-Layer í‰ê°€ í”„ë¡¬í”„íŠ¸ |
| **Pydantic Models** | `docs/postdocs/pydenticmodel.md` | íƒ€ì… ì •ì˜ ë° ë³€í™˜ í•¨ìˆ˜ |
| **Cross-Reference** | `docs/postdocs/crossref_mapping.md` | í•„ë“œ ë§¤í•‘ ì „ì²´ ì°¸ì¡° |

### 14.5 API ì—”ë“œí¬ì¸íŠ¸ ìš”ì•½

| Function | Method | Region | Timeout | Memory | ìš©ë„ |
|----------|--------|--------|---------|--------|------|
| `analyzeDesign` | onCall | asia-northeast3 | 300s | 512MB | ì´ë¯¸ì§€ ë¶„ì„ ë° 3-Layer í‰ê°€ |
| `chatWithMentor` | onCall | asia-northeast3 | 120s | 256MB | AI ë©˜í† ë§ ì±—ë´‡ |
| `searchSimilar` | onCall | asia-northeast3 | 60s | 256MB | ìœ ì‚¬ ë””ìì¸ ë²¡í„° ê²€ìƒ‰ |
| `getAnalyses` | onCall | asia-northeast3 | 60s | 256MB | ì‚¬ìš©ì ë¶„ì„ ëª©ë¡ ì¡°íšŒ |
| `getUserProfile` | onCall | asia-northeast3 | 60s | 256MB | ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ |

### 14.6 TypeScript íƒ€ì… ì •ì˜ (ìš”ì•½)

```typescript
// Core Types
export type FormatPrediction =
  | "UX_UI" | "Editorial" | "Poster"
  | "Thumbnail" | "Card" | "BI_CI" | "Unknown";

export type FixScope = "StructureRebuild" | "DetailTuning";

export type TrustVibe = "High" | "Medium" | "Low";
export type EngagementPotential = "High" | "Medium" | "Low";
export type EmotionalTone = "Calm" | "Energetic" | "Serious" | "Playful" | "Minimal";

// Firestore Document
export interface AnalysisDocument {
  userId: string;
  fileName: string;
  imageUrl: string;
  createdAt: Timestamp;
  updatedAt: Timestamp;

  formatPrediction: FormatPrediction;

  layer1Metrics: PerformanceMetrics;
  layer2Metrics: FormMetrics;
  layer3Metrics: CommunicativeMetrics;

  overallScore: number;
  fixScope: FixScope;

  colorPalette: ColorItem[];
  detectedKeywords: string[];
  ragSearchQueries: string[];
  nextActions: string[];

  // Vector Search (Strategy A)
  imageEmbedding?: number[];
  embeddingModel: string;
  embeddingDim: number;
  embeddingVersion: number;
  analysisVersion: number;
  lastAnalyzedAt: Timestamp;
}
```

### 14.7 schema.org ì •ë ¬

| Ontology Entity | schema.org Type | ì„¤ëª… |
|-----------------|-----------------|------|
| DesignWork | `VisualArtwork` + `CreativeWork` | ë””ìì¸ ì‘ì—…ë¬¼ |
| DesignGuideline | `CreativeWork` (êµìœ¡ ë¦¬ì†ŒìŠ¤í˜•) | ë””ìì¸ ê°€ì´ë“œë¼ì¸ |
| AcademicResource | `ScholarlyArticle` | í•™ìˆ  ìë£Œ |
| CurriculumUnit | `Course` / `LearningResource` | êµìœ¡ ë‹¨ìœ„ |

### 14.8 í”„ë¡ íŠ¸ì—”ë“œ ê¸°ìˆ  ìŠ¤íƒ ìƒì„¸

**HTML/CSS/JavaScript**:
- ìˆœìˆ˜ HTML5 (ë¹Œë“œ ë„êµ¬ ì—†ìŒ)
- ìˆœìˆ˜ CSS3 (`common.css`)
- ìˆœìˆ˜ JavaScript ES Modules
- `includHTML.js`ë¥¼ í†µí•œ ì»´í¬ë„ŒíŠ¸ ë¡œë“œ

**í°íŠ¸**:
- Rubik (Google Fonts) - weights: 300, 400, 500, 600, 700
- SUITE (CDN) - í•œê¸€ í°íŠ¸

**ì´ë¯¸ì§€ ë¦¬ì†ŒìŠ¤**:
- SVG ì•„ì´ì½˜ë“¤ (`img/` í´ë”)
- ì˜ˆì‹œ ì´ë¯¸ì§€ë“¤ (`img/ex1.png` ~ `img/ex21.png`)

**ë°˜ì‘í˜• ë””ìì¸**:
- VW/VH ë‹¨ìœ„ ì‚¬ìš© (ë·°í¬íŠ¸ ê¸°ë°˜)
- í”½ì…€ì„ VW/VHë¡œ ë³€í™˜í•˜ëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì‚¬ìš©

---

## 15. ì‹¤ì½”ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

> **ì°¸ì¡° ë¬¸ì„œ**: `docs/postdocs/cloudfunctions.md`, `docs/postdocs/pydenticmodel.md`, `docs/postdocs/bigquery.md`, `docs/postdocs/firestorevectordb.md`

ì´ ì„¹ì…˜ì€ ì‹¤ì½”ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìœ„í•œ ìƒì„¸ ëª…ì„¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### 15.1 Cloud Functions íŒŒì¼ êµ¬ì¡°

```
functions/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                  # Export onCall handlers only
â”‚   â”œâ”€â”€ types.ts                  # Shared TypeScript types
â”‚   â”œâ”€â”€ constants.ts              # Model names, versions, configs
â”‚   â”œâ”€â”€ analysis/
â”‚   â”‚   â”œâ”€â”€ visionSchema.ts       # Gemini Vision response schema (TS)
â”‚   â”‚   â”œâ”€â”€ analyzeDesign.ts      # analyzeDesign business logic
â”‚   â”‚   â”œâ”€â”€ diagnose.ts           # computeFixScope, meta diagnosis
â”‚   â”‚   â”œâ”€â”€ embedding.ts          # Image embedding generation
â”‚   â”‚   â”œâ”€â”€ converter.ts          # LLM â†’ Firestore ë³€í™˜
â”‚   â”‚   â””â”€â”€ bigqueryWriter.ts     # BigQuery insert utilities
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â””â”€â”€ chatWithMentor.ts     # Chat tutor logic
â”‚   â”œâ”€â”€ search/
â”‚   â”‚   â””â”€â”€ searchSimilar.ts      # Vector search logic
â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â””â”€â”€ profileFunctions.ts   # User profile CRUD
â”‚   â”œâ”€â”€ collections/
â”‚   â”‚   â””â”€â”€ collectionFunctions.ts
â”‚   â””â”€â”€ bookmarks/
â”‚       â””â”€â”€ bookmarkFunctions.ts
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### 15.2 Constants (`constants.ts`)

```typescript
// Model Configuration (from baseline_spec.md)
export const VISION_MODEL = "gemini-3-pro-preview";
export const CHAT_MODEL = "gemini-2.5-flash";
export const EMBEDDING_MODEL = "multimodalembedding@001";
export const EMBEDDING_DIM = 512;

// Version Management
export const ANALYSIS_VERSION = 1;
export const EMBEDDING_VERSION = 1;

// Generation Configs
export const VISION_CONFIG = {
  temperature: 0.2,
  topP: 0.95,
  topK: 40,
  maxOutputTokens: 8192,
};

export const CHAT_CONFIG = {
  temperature: 0.7,
  topP: 0.9,
  maxOutputTokens: 2048,
};

// BigQuery (Optional)
export const BQ_DATASET = "dysapp";  // dysproto â†’ dysapp
export const BQ_TABLE_WORK = "design_work";
export const BQ_TABLE_METRICS = "design_metrics";
```

### 15.3 TypeScript íƒ€ì… ì •ì˜ (`types.ts`)

**Firestore íƒ€ì… (camelCase)**

```typescript
import { Timestamp, FieldValue } from "firebase-admin/firestore";

export interface AccessibilityFlags {
  lowContrast: boolean;
  tinyText: boolean;
  cluttered: boolean;
}

export interface PerformanceMetrics {
  hierarchyScore: number;
  scanabilityScore: number;
  goalClarityScore: number;
  accessibility: AccessibilityFlags;
  diagnosisSummary: string;
}

export interface FormMetrics {
  gridConsistency: number;
  visualBalance: number;
  colorHarmony: number;
  typographyQuality: number;
}

export interface CommunicativeMetrics {
  trustVibe: "High" | "Medium" | "Low";
  engagementPotential: "High" | "Medium" | "Low";
  emotionalTone: "Calm" | "Energetic" | "Serious" | "Playful" | "Minimal";
}

export interface ColorItem {
  hex: string;
  approxName: string;
  usageRatio: number;
}

export type FormatPrediction =
  | "UX_UI" | "Editorial" | "Poster"
  | "Thumbnail" | "Card" | "BI_CI" | "Unknown";

export type FixScope = "StructureRebuild" | "DetailTuning";

export interface AnalysisDocument {
  userId: string;
  fileName: string;
  imageUrl: string;
  createdAt: Timestamp | FieldValue;
  updatedAt: Timestamp | FieldValue;
  lastAnalyzedAt: Timestamp | FieldValue;

  formatPrediction: FormatPrediction;

  layer1Metrics: PerformanceMetrics;
  layer2Metrics: FormMetrics;
  layer3Metrics: CommunicativeMetrics;

  overallScore: number;
  fixScope: FixScope;

  colorPalette: ColorItem[];
  detectedKeywords: string[];
  ragSearchQueries: string[];
  nextActions: string[];

  // Vector Search (Strategy A)
  imageEmbedding?: number[];      // 512-dim, optional until generated
  embeddingModel: string;         // "multimodalembedding@001"
  embeddingDim: number;           // 512
  embeddingVersion: number;        // 1
  analysisVersion: number;         // 1
}
```

**LLM ì¶œë ¥ íƒ€ì… (snake_case)**

```typescript
export interface LLMAccessibilityFlags {
  low_contrast: boolean;
  tiny_text: boolean;
  cluttered: boolean;
}

export interface LLMPerformanceMetrics {
  hierarchy_score: number;
  scanability_score: number;
  goal_clarity_score: number;
  accessibility: LLMAccessibilityFlags;
  diagnosis_summary: string;
}

export interface LLMFormMetrics {
  grid_consistency: number;
  visual_balance: number;
  color_harmony: number;
  typography_quality: number;
}

export interface LLMCommunicativeMetrics {
  trust_vibe: "High" | "Medium" | "Low";
  engagement_potential: "High" | "Medium" | "Low";
  emotional_tone: "Calm" | "Energetic" | "Serious" | "Playful" | "Minimal";
}

export interface LLMColorItem {
  hex: string;
  approx_name: string;
  usage_ratio: number;
}

export interface DesignAnalysisResultLLM {
  format_prediction: FormatPrediction;
  layer1_performance: LLMPerformanceMetrics;
  layer2_form: LLMFormMetrics;
  layer3_communicative: LLMCommunicativeMetrics;
  overall_score: number;
  fix_scope: FixScope;
  color_palette: LLMColorItem[];
  detected_keywords: string[];
  rag_search_queries: string[];
  next_actions: string[];
}
```

### 15.4 Pydantic ëª¨ë¸ ì •ì˜ (Python ë°±ì—”ë“œìš©)

**LLM ì¶œë ¥ ëª¨ë¸ (snake_case)**

```python
from typing import List, Literal
from pydantic import BaseModel, Field, ConfigDict

class AccessibilityFlagsLLM(BaseModel):
    model_config = ConfigDict(extra="forbid")
    low_contrast: bool
    tiny_text: bool
    cluttered: bool

class PerformanceMetricsLLM(BaseModel):
    model_config = ConfigDict(extra="forbid")
    hierarchy_score: int = Field(..., ge=0, le=100)
    scanability_score: int = Field(..., ge=0, le=100)
    goal_clarity_score: int = Field(..., ge=0, le=100)
    accessibility: AccessibilityFlagsLLM
    diagnosis_summary: str

class FormMetricsLLM(BaseModel):
    model_config = ConfigDict(extra="forbid")
    grid_consistency: int = Field(..., ge=0, le=100)
    visual_balance: int = Field(..., ge=0, le=100)
    color_harmony: int = Field(..., ge=0, le=100)
    typography_quality: int = Field(..., ge=0, le=100)

class CommunicativeMetricsLLM(BaseModel):
    model_config = ConfigDict(extra="forbid")
    trust_vibe: Literal["High", "Medium", "Low"]
    engagement_potential: Literal["High", "Medium", "Low"]
    emotional_tone: Literal["Calm", "Energetic", "Serious", "Playful", "Minimal"]

class ColorItemLLM(BaseModel):
    model_config = ConfigDict(extra="forbid")
    hex: str
    approx_name: str
    usage_ratio: float = Field(..., ge=0.0, le=1.0)

class DesignAnalysisResultLLM(BaseModel):
    model_config = ConfigDict(extra="forbid")
    format_prediction: Literal["UX_UI", "Editorial", "Poster", "Thumbnail", "Card", "BI_CI", "Unknown"]
    layer1_performance: PerformanceMetricsLLM
    layer2_form: FormMetricsLLM
    layer3_communicative: CommunicativeMetricsLLM
    overall_score: int = Field(..., ge=0, le=100)
    fix_scope: Literal["StructureRebuild", "DetailTuning"]
    color_palette: List[ColorItemLLM] = Field(default_factory=list, max_length=5)
    detected_keywords: List[str] = Field(default_factory=list, max_length=20)
    rag_search_queries: List[str] = Field(default_factory=list, max_length=5)
    next_actions: List[str] = Field(default_factory=list, max_length=5)
```

**Firestore ëª¨ë¸ (camelCase)**

```python
from datetime import datetime
from typing import List, Literal, Optional
from pydantic import BaseModel, Field, ConfigDict

class AccessibilityFlags(BaseModel):
    model_config = ConfigDict(extra="forbid")
    lowContrast: bool
    tinyText: bool
    cluttered: bool

class PerformanceMetrics(BaseModel):
    model_config = ConfigDict(extra="forbid")
    hierarchyScore: int = Field(..., ge=0, le=100)
    scanabilityScore: int = Field(..., ge=0, le=100)
    goalClarityScore: int = Field(..., ge=0, le=100)
    accessibility: AccessibilityFlags
    diagnosisSummary: str

class FormMetrics(BaseModel):
    model_config = ConfigDict(extra="forbid")
    gridConsistency: int = Field(..., ge=0, le=100)
    visualBalance: int = Field(..., ge=0, le=100)
    colorHarmony: int = Field(..., ge=0, le=100)
    typographyQuality: int = Field(..., ge=0, le=100)

class CommunicativeMetrics(BaseModel):
    model_config = ConfigDict(extra="forbid")
    trustVibe: Literal["High", "Medium", "Low"]
    engagementPotential: Literal["High", "Medium", "Low"]
    emotionalTone: Literal["Calm", "Energetic", "Serious", "Playful", "Minimal"]

class ColorItem(BaseModel):
    model_config = ConfigDict(extra="forbid")
    hex: str
    approxName: str
    usageRatio: float = Field(..., ge=0.0, le=1.0)

class AnalysisDocument(BaseModel):
    model_config = ConfigDict(extra="forbid")
    userId: str
    fileName: str
    imageUrl: str
    createdAt: datetime
    updatedAt: datetime
    lastAnalyzedAt: datetime
    formatPrediction: Literal["UX_UI", "Editorial", "Poster", "Thumbnail", "Card", "BI_CI", "Unknown"]
    layer1Metrics: PerformanceMetrics
    layer2Metrics: FormMetrics
    layer3Metrics: CommunicativeMetrics
    overallScore: int = Field(..., ge=0, le=100)
    fixScope: Literal["StructureRebuild", "DetailTuning"]
    colorPalette: List[ColorItem] = Field(default_factory=list)
    detectedKeywords: List[str] = Field(default_factory=list)
    ragSearchQueries: List[str] = Field(default_factory=list)
    nextActions: List[str] = Field(default_factory=list)
    imageEmbedding: Optional[List[float]] = Field(default=None, description="512-dim vector")
    embeddingModel: str = Field(default="multimodalembedding@001")
    embeddingDim: int = Field(default=512)
    embeddingVersion: int = Field(default=1)
    analysisVersion: int = Field(default=1)
```

**BigQuery Row ëª¨ë¸ (snake_case)**

```python
class DesignWorkRow(BaseModel):
    model_config = ConfigDict(extra="forbid")
    id: str
    user_id: str
    file_name: Optional[str] = None
    title: Optional[str] = None
    description: Optional[str] = None
    format: str
    goal_type: Optional[str] = None
    target_audience: Optional[str] = None
    platform: Optional[str] = None
    in_language: Optional[str] = None
    image_url: str
    created_at: datetime
    updated_at: datetime
    applies_guidelines: List[str] = Field(default_factory=list)
    suitable_for_curricula: List[str] = Field(default_factory=list)
    analysis_version: int
    embedding_version: int

class ColorItemRow(BaseModel):
    hex: str
    approx_name: str
    usage_ratio: float

class DesignMetricsRow(BaseModel):
    model_config = ConfigDict(extra="forbid")
    id: str
    analyzed_at: datetime
    layer1_hierarchy_score: int
    layer1_scanability_score: int
    layer1_goal_clarity_score: int
    layer1_accessibility_low_contrast: bool
    layer1_accessibility_tiny_text: bool
    layer1_accessibility_cluttered: bool
    layer1_diagnosis_summary: str
    layer2_grid_consistency: int
    layer2_visual_balance: int
    layer2_color_harmony: int
    layer2_typography_quality: int
    layer3_trust_vibe: str
    layer3_engagement_potential: str
    layer3_emotional_tone: str
    overall_score: int
    fix_scope: str
    color_palette: List[ColorItemRow] = Field(default_factory=list)
    detected_keywords: List[str] = Field(default_factory=list)
    rag_search_queries: List[str] = Field(default_factory=list)
```

### 15.5 ë³€í™˜ í•¨ìˆ˜

**LLM â†’ Firestore (Python)**

```python
def llm_to_firestore(
    llm: DesignAnalysisResultLLM,
    user_id: str,
    file_name: str,
    image_url: str,
    embedding: Optional[List[float]] = None
) -> AnalysisDocument:
    """LLM ì¶œë ¥(snake_case)ì„ Firestore ë¬¸ì„œ(camelCase)ë¡œ ë³€í™˜"""
    now = datetime.utcnow()
    
    return AnalysisDocument(
        userId=user_id,
        fileName=file_name,
        imageUrl=image_url,
        createdAt=now,
        updatedAt=now,
        lastAnalyzedAt=now,
        formatPrediction=llm.format_prediction,
        layer1Metrics=PerformanceMetrics(
            hierarchyScore=llm.layer1_performance.hierarchy_score,
            scanabilityScore=llm.layer1_performance.scanability_score,
            goalClarityScore=llm.layer1_performance.goal_clarity_score,
            accessibility=AccessibilityFlags(
                lowContrast=llm.layer1_performance.accessibility.low_contrast,
                tinyText=llm.layer1_performance.accessibility.tiny_text,
                cluttered=llm.layer1_performance.accessibility.cluttered,
            ),
            diagnosisSummary=llm.layer1_performance.diagnosis_summary,
        ),
        layer2Metrics=FormMetrics(
            gridConsistency=llm.layer2_form.grid_consistency,
            visualBalance=llm.layer2_form.visual_balance,
            colorHarmony=llm.layer2_form.color_harmony,
            typographyQuality=llm.layer2_form.typography_quality,
        ),
        layer3Metrics=CommunicativeMetrics(
            trustVibe=llm.layer3_communicative.trust_vibe,
            engagementPotential=llm.layer3_communicative.engagement_potential,
            emotionalTone=llm.layer3_communicative.emotional_tone,
        ),
        overallScore=llm.overall_score,
        fixScope=llm.fix_scope,
        colorPalette=[
            ColorItem(hex=c.hex, approxName=c.approx_name, usageRatio=c.usage_ratio)
            for c in llm.color_palette
        ],
        detectedKeywords=llm.detected_keywords,
        ragSearchQueries=llm.rag_search_queries,
        nextActions=llm.next_actions,
        imageEmbedding=embedding,
        embeddingModel="multimodalembedding@001",
        embeddingDim=512,
        embeddingVersion=1,
        analysisVersion=1,
    )
```

**LLM â†’ Firestore (TypeScript)**

```typescript
import { FieldValue } from "firebase-admin/firestore";
import {
  DesignAnalysisResultLLM,
  AnalysisDocument,
  PerformanceMetrics,
  FormMetrics,
  CommunicativeMetrics,
  ColorItem,
} from "../types";
import { EMBEDDING_MODEL, EMBEDDING_DIM, ANALYSIS_VERSION, EMBEDDING_VERSION } from "../constants";

export function llmToFirestore(
  llm: DesignAnalysisResultLLM,
  userId: string,
  fileName: string,
  imageUrl: string
): Omit<AnalysisDocument, "imageEmbedding"> {
  const layer1Metrics: PerformanceMetrics = {
    hierarchyScore: llm.layer1_performance.hierarchy_score,
    scanabilityScore: llm.layer1_performance.scanability_score,
    goalClarityScore: llm.layer1_performance.goal_clarity_score,
    accessibility: {
      lowContrast: llm.layer1_performance.accessibility.low_contrast,
      tinyText: llm.layer1_performance.accessibility.tiny_text,
      cluttered: llm.layer1_performance.accessibility.cluttered,
    },
    diagnosisSummary: llm.layer1_performance.diagnosis_summary,
  };

  const layer2Metrics: FormMetrics = {
    gridConsistency: llm.layer2_form.grid_consistency,
    visualBalance: llm.layer2_form.visual_balance,
    colorHarmony: llm.layer2_form.color_harmony,
    typographyQuality: llm.layer2_form.typography_quality,
  };

  const layer3Metrics: CommunicativeMetrics = {
    trustVibe: llm.layer3_communicative.trust_vibe,
    engagementPotential: llm.layer3_communicative.engagement_potential,
    emotionalTone: llm.layer3_communicative.emotional_tone,
  };

  const colorPalette: ColorItem[] = llm.color_palette.map((c) => ({
    hex: c.hex,
    approxName: c.approx_name,
    usageRatio: c.usage_ratio,
  }));

  return {
    userId,
    fileName,
    imageUrl,
    createdAt: FieldValue.serverTimestamp(),
    updatedAt: FieldValue.serverTimestamp(),
    lastAnalyzedAt: FieldValue.serverTimestamp(),
    formatPrediction: llm.format_prediction,
    layer1Metrics,
    layer2Metrics,
    layer3Metrics,
    overallScore: llm.overall_score,
    fixScope: llm.fix_scope,
    colorPalette,
    detectedKeywords: llm.detected_keywords,
    ragSearchQueries: llm.rag_search_queries,
    nextActions: llm.next_actions,
    embeddingModel: EMBEDDING_MODEL,
    embeddingDim: EMBEDDING_DIM,
    embeddingVersion: EMBEDDING_VERSION,
    analysisVersion: ANALYSIS_VERSION,
  };
}
```

**Firestore â†’ BigQuery (Python)**

```python
def firestore_to_bq_work(doc: AnalysisDocument, doc_id: str) -> DesignWorkRow:
    """Firestore ë¬¸ì„œë¥¼ BigQuery design_work Rowë¡œ ë³€í™˜"""
    return DesignWorkRow(
        id=doc_id,
        user_id=doc.userId,
        file_name=doc.fileName,
        format=doc.formatPrediction,
        image_url=doc.imageUrl,
        created_at=doc.createdAt,
        updated_at=doc.updatedAt,
        analysis_version=doc.analysisVersion,
        embedding_version=doc.embeddingVersion,
        applies_guidelines=[],
        suitable_for_curricula=[],
    )

def firestore_to_bq_metrics(doc: AnalysisDocument, doc_id: str) -> DesignMetricsRow:
    """Firestore ë¬¸ì„œë¥¼ BigQuery design_metrics Rowë¡œ ë³€í™˜"""
    return DesignMetricsRow(
        id=doc_id,
        analyzed_at=doc.lastAnalyzedAt,
        layer1_hierarchy_score=doc.layer1Metrics.hierarchyScore,
        layer1_scanability_score=doc.layer1Metrics.scanabilityScore,
        layer1_goal_clarity_score=doc.layer1Metrics.goalClarityScore,
        layer1_accessibility_low_contrast=doc.layer1Metrics.accessibility.lowContrast,
        layer1_accessibility_tiny_text=doc.layer1Metrics.accessibility.tinyText,
        layer1_accessibility_cluttered=doc.layer1Metrics.accessibility.cluttered,
        layer1_diagnosis_summary=doc.layer1Metrics.diagnosisSummary,
        layer2_grid_consistency=doc.layer2Metrics.gridConsistency,
        layer2_visual_balance=doc.layer2Metrics.visualBalance,
        layer2_color_harmony=doc.layer2Metrics.colorHarmony,
        layer2_typography_quality=doc.layer2Metrics.typographyQuality,
        layer3_trust_vibe=doc.layer3Metrics.trustVibe,
        layer3_engagement_potential=doc.layer3Metrics.engagementPotential,
        layer3_emotional_tone=doc.layer3Metrics.emotionalTone,
        overall_score=doc.overallScore,
        fix_scope=doc.fixScope,
        color_palette=[
            ColorItemRow(hex=c.hex, approx_name=c.approxName, usage_ratio=c.usageRatio)
            for c in doc.colorPalette
        ],
        detected_keywords=doc.detectedKeywords,
        rag_search_queries=doc.ragSearchQueries,
    )
```

### 15.6 BigQuery DDL (ì „ì²´)

**ë©”ì¸ ì—”í‹°í‹° í…Œì´ë¸”**

```sql
-- design_work í…Œì´ë¸”
CREATE TABLE `dysapp.design_work` (
  id STRING NOT NULL,
  user_id STRING NOT NULL,
  file_name STRING,
  title STRING,
  description STRING,
  format STRING,
  goal_type STRING,
  target_audience STRING,
  platform STRING,
  in_language STRING,
  image_url STRING,
  created_at TIMESTAMP,
  updated_at TIMESTAMP,
  applies_guidelines ARRAY<STRING>,
  suitable_for_curricula ARRAY<STRING>,
  analysis_version INT64,
  embedding_version INT64
);

-- design_metrics í…Œì´ë¸”
CREATE TABLE `dysapp.design_metrics` (
  id STRING NOT NULL,
  analyzed_at TIMESTAMP,
  layer1_hierarchy_score INT64,
  layer1_scanability_score INT64,
  layer1_goal_clarity_score INT64,
  layer1_accessibility_low_contrast BOOL,
  layer1_accessibility_tiny_text BOOL,
  layer1_accessibility_cluttered BOOL,
  layer1_diagnosis_summary STRING,
  layer2_grid_consistency INT64,
  layer2_visual_balance INT64,
  layer2_color_harmony INT64,
  layer2_typography_quality INT64,
  layer3_trust_vibe STRING,
  layer3_engagement_potential STRING,
  layer3_emotional_tone STRING,
  overall_score INT64,
  fix_scope STRING,
  color_palette ARRAY<STRUCT<
    hex STRING,
    approx_name STRING,
    usage_ratio FLOAT64
  >>,
  detected_keywords ARRAY<STRING>,
  rag_search_queries ARRAY<STRING>
);
```

**ì§€ì‹ ë² ì´ìŠ¤ í…Œì´ë¸” (v2+)**

```sql
-- ref_theory_nodes (DesignGuideline)
CREATE TABLE `dysapp.ref_theory_nodes` (
  id STRING NOT NULL,
  title STRING,
  summary STRING,
  full_text STRING,
  layer STRING,
  domain STRING,
  principles ARRAY<STRING>,
  source_type STRING,
  source_citation STRING,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);

-- academic_resources (AcademicResource)
CREATE TABLE `dysapp.academic_resources` (
  id STRING NOT NULL,
  type STRING,
  title STRING,
  abstract STRING,
  authors ARRAY<STRING>,
  year INT64,
  publisher STRING,
  doi STRING,
  url STRING,
  research_area STRING,
  tags ARRAY<STRING>,
  created_at TIMESTAMP
);

-- curriculum_units (CurriculumUnit)
CREATE TABLE `dysapp.curriculum_units` (
  id STRING NOT NULL,
  title STRING,
  description STRING,
  level STRING,
  duration_hours FLOAT64,
  institution STRING,
  instructor_name STRING,
  topics ARRAY<STRING>,
  related_guidelines ARRAY<STRING>,
  created_at TIMESTAMP
);

-- industry_stats (IndustryStat)
CREATE TABLE `dysapp.industry_stats` (
  id STRING NOT NULL,
  title STRING,
  year INT64,
  data_source STRING,
  metrics JSON,
  tags ARRAY<STRING>,
  created_at TIMESTAMP
);
```

**A/B í…ŒìŠ¤íŠ¸ í…Œì´ë¸”**

```sql
-- ab_sessions
CREATE TABLE `dysapp.ab_sessions` (
  session_id STRING NOT NULL,
  user_id STRING,
  variant STRING,
  started_at TIMESTAMP,
  ended_at TIMESTAMP,
  design_work_id STRING,
  fix_scope STRING,
  satisfaction_score INT64,
  notes STRING
);

-- ab_events
CREATE TABLE `dysapp.ab_events` (
  session_id STRING,
  event_time TIMESTAMP,
  event_type STRING,
  payload JSON
);
```

### 15.7 Firestore Index ì„¤ì •

**firestore.indexes.json**

```json
{
  "indexes": [
    {
      "collectionGroup": "analyses",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "userId", "order": "ASCENDING" },
        { "fieldPath": "createdAt", "order": "DESCENDING" }
      ]
    },
    {
      "collectionGroup": "analyses",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "userId", "order": "ASCENDING" },
        { "fieldPath": "formatPrediction", "order": "ASCENDING" }
      ]
    },
    {
      "collectionGroup": "analyses",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "userId", "order": "ASCENDING" },
        { "fieldPath": "fixScope", "order": "ASCENDING" }
      ]
    }
  ],
  "fieldOverrides": [
    {
      "collectionGroup": "analyses",
      "fieldPath": "imageEmbedding",
      "indexes": [
        {
          "order": "ASCENDING",
          "queryScope": "COLLECTION"
        },
        {
          "dimensions": 512,
          "flat": {},
          "queryScope": "COLLECTION"
        }
      ]
    }
  ]
}
```

### 15.8 API ì—”ë“œí¬ì¸íŠ¸ ìƒì„¸ ëª…ì„¸

#### 15.8.1 analyzeDesign

**Request Type:**

```typescript
interface AnalyzeDesignRequest {
  imageData: string;  // base64 encoded image
  mimeType: string;   // "image/png", "image/jpeg", etc.
  fileName: string;
}
```

**Response Type:**

```typescript
interface AnalyzeDesignResponse {
  success: boolean;
  analysisId: string;
  imageUrl: string;
  formatPrediction: FormatPrediction;
  overallScore: number;
  fixScope: FixScope;
  layer1Metrics: PerformanceMetrics;
  layer2Metrics: FormMetrics;
  layer3Metrics: CommunicativeMetrics;
  colorPalette: ColorItem[];
  detectedKeywords: string[];
  nextActions: string[];
}
```

**ì—ëŸ¬ ì²˜ë¦¬:**

| ì—ëŸ¬ ì½”ë“œ | ì¡°ê±´ | ë©”ì‹œì§€ |
|----------|------|--------|
| `unauthenticated` | ì¸ì¦ ì—†ìŒ | "Authentication required" |
| `invalid-argument` | í•„ìˆ˜ í•„ë“œ ëˆ„ë½ | "Missing required fields: imageData, mimeType, fileName" |
| `internal` | ë¶„ì„ ì‹¤íŒ¨ | "Analysis failed" |

#### 15.8.2 chatWithMentor

**Request Type:**

```typescript
interface ChatRequest {
  analysisId: string;
  message: string;
  sessionId?: string;  // Optional: ê¸°ì¡´ ì„¸ì…˜ ID
}
```

**Response Type:**

```typescript
interface ChatResponse {
  success: boolean;
  sessionId: string;
  response: string;
}
```

**ì—ëŸ¬ ì²˜ë¦¬:**

| ì—ëŸ¬ ì½”ë“œ | ì¡°ê±´ | ë©”ì‹œì§€ |
|----------|------|--------|
| `unauthenticated` | ì¸ì¦ ì—†ìŒ | "Authentication required" |
| `invalid-argument` | í•„ìˆ˜ í•„ë“œ ëˆ„ë½ | "Missing analysisId or message" |
| `not-found` | analysisId ì—†ìŒ | "Analysis not found" |
| `permission-denied` | íƒ€ì¸ì˜ ë¶„ì„ ì ‘ê·¼ | "Not your analysis" |
| `internal` | ì±— ì‹¤íŒ¨ | "Chat failed" |

#### 15.8.3 searchSimilar

**Request Type:**

```typescript
interface SearchRequest {
  analysisId: string;
  limit?: number;           // Default: 10
  filterFormat?: FormatPrediction;
  filterFixScope?: FixScope;
}
```

**Response Type:**

```typescript
interface SearchResponse {
  success: boolean;
  results: Array<{
    id: string;
    distance: number;       // Cosine distance
    formatPrediction: FormatPrediction;
    overallScore: number;
    fixScope: FixScope;
    imageUrl: string;
    fileName: string;
  }>;
  count: number;
}
```

**ì—ëŸ¬ ì²˜ë¦¬:**

| ì—ëŸ¬ ì½”ë“œ | ì¡°ê±´ | ë©”ì‹œì§€ |
|----------|------|--------|
| `unauthenticated` | ì¸ì¦ ì—†ìŒ | "Authentication required" |
| `invalid-argument` | analysisId ëˆ„ë½ | "Missing analysisId" |
| `not-found` | analysisId ì—†ìŒ | "Analysis not found" |
| `failed-precondition` | ì„ë² ë”© ì—†ìŒ | "No embedding available" |
| `internal` | ê²€ìƒ‰ ì‹¤íŒ¨ | "Search failed" |

### 15.9 Vector Search êµ¬í˜„

**ì„ë² ë”© ìƒì„± (TypeScript)**

```typescript
import { VertexAI } from "@google-cloud/vertexai";

const vertexAI = new VertexAI({
  project: process.env.GOOGLE_CLOUD_PROJECT,
  location: "us-central1",
});

async function generateImageEmbedding(
  imageBytes: Buffer
): Promise<number[]> {
  const model = vertexAI.preview.getGenerativeModel({
    model: "multimodalembedding@001",
  });

  const result = await model.embedContent({
    content: {
      role: "user",
      parts: [
        {
          inlineData: {
            mimeType: "image/jpeg",
            data: imageBytes.toString("base64"),
          },
        },
      ],
    },
  });

  return result.embedding.values;  // 512-dim vector
}
```

**Vector Search ì¿¼ë¦¬ íŒ¨í„´**

```typescript
// Pattern 1: User-scoped similar designs
async function findSimilarDesigns(
  userId: string,
  queryVector: number[],
  limit: number = 20
): Promise<QueryDocumentSnapshot[]> {
  const snapshot = await db.collection("analyses")
    .where("userId", "==", userId)
    .findNearest({
      vectorField: "imageEmbedding",
      queryVector: queryVector,
      limit: limit,
      distanceMeasure: "COSINE"
    })
    .get();

  return snapshot.docs;
}

// Pattern 2: Format-filtered reference search
async function findFormatReferences(
  format: FormatPrediction,
  queryVector: number[],
  minScore: number = 70,
  limit: number = 10
): Promise<QueryDocumentSnapshot[]> {
  const snapshot = await db.collection("analyses")
    .where("formatPrediction", "==", format)
    .where("overallScore", ">=", minScore)
    .findNearest({
      vectorField: "imageEmbedding",
      queryVector: queryVector,
      limit: limit,
      distanceMeasure: "COSINE"
    })
    .get();

  return snapshot.docs;
}

// Pattern 3: FixScope-aware examples
async function findFixScopeExamples(
  fixScope: FixScope,
  queryVector: number[],
  limit: number = 5
): Promise<QueryDocumentSnapshot[]> {
  const snapshot = await db.collection("analyses")
    .where("fixScope", "==", fixScope)
    .findNearest({
      vectorField: "imageEmbedding",
      queryVector: queryVector,
      limit: limit,
      distanceMeasure: "COSINE"
    })
    .get();

  return snapshot.docs;
}
```

### 15.10 Vision Schema ë° System Instruction

**Gemini Vision Schema (TypeScript)**

```typescript
import { SchemaType } from "@google/generative-ai";

export const DESIGN_ANALYSIS_SCHEMA = {
  type: SchemaType.OBJECT,
  properties: {
    format_prediction: {
      type: SchemaType.STRING,
      enum: ["UX_UI", "Editorial", "Poster", "Thumbnail", "Card", "BI_CI", "Unknown"],
    },
    layer1_performance: {
      type: SchemaType.OBJECT,
      properties: {
        hierarchy_score: { type: SchemaType.INTEGER },
        scanability_score: { type: SchemaType.INTEGER },
        goal_clarity_score: { type: SchemaType.INTEGER },
        accessibility: {
          type: SchemaType.OBJECT,
          properties: {
            low_contrast: { type: SchemaType.BOOLEAN },
            tiny_text: { type: SchemaType.BOOLEAN },
            cluttered: { type: SchemaType.BOOLEAN },
          },
          required: ["low_contrast", "tiny_text", "cluttered"],
        },
        diagnosis_summary: { type: SchemaType.STRING },
      },
      required: ["hierarchy_score", "scanability_score", "goal_clarity_score", "accessibility", "diagnosis_summary"],
    },
    layer2_form: {
      type: SchemaType.OBJECT,
      properties: {
        grid_consistency: { type: SchemaType.INTEGER },
        visual_balance: { type: SchemaType.INTEGER },
        color_harmony: { type: SchemaType.INTEGER },
        typography_quality: { type: SchemaType.INTEGER },
      },
      required: ["grid_consistency", "visual_balance", "color_harmony", "typography_quality"],
    },
    layer3_communicative: {
      type: SchemaType.OBJECT,
      properties: {
        trust_vibe: { type: SchemaType.STRING, enum: ["High", "Medium", "Low"] },
        engagement_potential: { type: SchemaType.STRING, enum: ["High", "Medium", "Low"] },
        emotional_tone: { type: SchemaType.STRING, enum: ["Calm", "Energetic", "Serious", "Playful", "Minimal"] },
      },
      required: ["trust_vibe", "engagement_potential", "emotional_tone"],
    },
    overall_score: { type: SchemaType.INTEGER },
    fix_scope: { type: SchemaType.STRING, enum: ["StructureRebuild", "DetailTuning"] },
    color_palette: {
      type: SchemaType.ARRAY,
      items: {
        type: SchemaType.OBJECT,
        properties: {
          hex: { type: SchemaType.STRING },
          approx_name: { type: SchemaType.STRING },
          usage_ratio: { type: SchemaType.NUMBER },
        },
        required: ["hex", "approx_name", "usage_ratio"],
      },
    },
    detected_keywords: { type: SchemaType.ARRAY, items: { type: SchemaType.STRING } },
    next_actions: { type: SchemaType.ARRAY, items: { type: SchemaType.STRING } },
    rag_search_queries: { type: SchemaType.ARRAY, items: { type: SchemaType.STRING } },
  },
  required: [
    "format_prediction",
    "layer1_performance",
    "layer2_form",
    "layer3_communicative",
    "overall_score",
    "fix_scope",
    "color_palette",
    "detected_keywords",
    "next_actions",
    "rag_search_queries",
  ],
};
```

**System Instruction**

```typescript
export const VISION_SYSTEM_INSTRUCTION = `
**Role:**
You are the "dysapp Design Tutor," an expert AI utilizing Modernist Design Theory (Bauhaus, Swiss Style) and Information Design principles to critique visual works.

**Task:**
Analyze the provided image based on the "3-Layer Design Evaluation Framework" and return the result strictly as a JSON object.

**Evaluation Framework:**

**Layer 1: Performance & Information (50%)**
- hierarchy_score: Visual hierarchy clarity (0-100)
- scanability_score: Information grouping and scan speed (0-100)
- goal_clarity_score: Topic/action recognition (0-100)
- accessibility: Check low_contrast, tiny_text, cluttered
- diagnosis_summary: 1 sentence diagnosis (Korean if applicable)

**Layer 2: Aesthetic & Form (30%)**
- grid_consistency: Alignment accuracy (0-100)
- visual_balance: Geometric equilibrium (0-100)
- color_harmony: Palette theory adherence (0-100)
- typography_quality: Font choice/spacing (0-100)

**Layer 3: Communicative Impact (20%)**
- trust_vibe: High/Medium/Low
- engagement_potential: High/Medium/Low
- emotional_tone: Calm/Energetic/Serious/Playful/Minimal

**Rules:**
1. JSON ONLY - no markdown or explanatory text
2. Scores 0-100, average good work ~75, don't give 90+ easily
3. next_actions must be specific and actionable
4. Korean context: provide Korean text for diagnosis_summary and next_actions
5. fix_scope: "StructureRebuild" if Layer1 avg < 60, else "DetailTuning"
`;
```

### 15.11 FixScope ê³„ì‚° ë¡œì§

```typescript
import { PerformanceMetrics, FormMetrics, FixScope } from "../types";

export function computeFixScope(
  l1: PerformanceMetrics,
  l2: FormMetrics
): FixScope {
  // Rule 1: Critical structural failure
  if (l1.hierarchyScore < 50 || l1.goalClarityScore < 50) {
    return "StructureRebuild";
  }

  // Rule 2: Scanability failure
  if (l1.scanabilityScore < 50) {
    return "StructureRebuild";
  }

  // Rule 3: Structure OK, form needs work
  if (l1.hierarchyScore >= 60 && l2.gridConsistency < 80) {
    return "DetailTuning";
  }

  // Rule 4: Ambiguous case (50-60 range)
  if (l1.hierarchyScore >= 50 && l1.hierarchyScore < 60) {
    return "StructureRebuild"; // Default to rebuild
  }

  return "DetailTuning";
}

export function validateFixScope(
  llmFixScope: FixScope,
  l1: PerformanceMetrics,
  l2: FormMetrics
): { fixScope: FixScope; overridden: boolean; reason?: string } {
  const ruleFixScope = computeFixScope(l1, l2);

  if (llmFixScope !== ruleFixScope) {
    return {
      fixScope: ruleFixScope,
      overridden: true,
      reason: `LLM suggested ${llmFixScope}, rule computed ${ruleFixScope}`,
    };
  }

  return { fixScope: llmFixScope, overridden: false };
}
```

---

## Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2025-01-27 | Initial PRD for dysapp project |
| 1.1 | 2025-01-27 | Added ì‹¤ì½”ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ (Section 15) with Pydantic models, API specs, BigQuery DDL, Firestore indexes |

---

*Generated for dysapp project (Firebase Project ID: dysapp1210)*

