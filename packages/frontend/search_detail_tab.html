<!DOCTYPE html>
<html lang="en">

<!-- =========================================
     페이지: 검색 상세 페이지 (search_detail_tab.html)
     ========================================= 
     목적: 검색 결과의 상세 정보를 표시하는 페이지
     
     주요 기능:
     - 선택된 검색 결과의 상세 정보 표시
     - 추천 근거 및 개선 방안 표시
     - 유사 이미지 목록 표시
     - 이미지 다운로드, 공유 기능
     
     특징:
     - 인라인 JavaScript로 이미지 호버 효과 및 버튼 위치 조정
     - VW/VH 단위를 사용한 반응형 레이아웃
     - 이미지 호버 시 다운로드/공유 버튼 표시
     
     참고:
     - 이 페이지는 검색 결과에서 특정 이미지를 클릭했을 때 표시됨
     - 인라인 스크립트로 복잡한 호버 효과 구현
-->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>검색 상세 - Dys</title>
    
    <!-- 전역 스타일시트 -->
    <link rel="stylesheet" href="./common.css">
    
    <!-- 외부 폰트 -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/sun-typeface/SUITE/fonts/static/woff2/SUITE.css" rel="stylesheet">
    
    <!-- HTML Include 유틸리티 -->
    <script src="./includHTML.js" defer></script>
</head>

<body>
    <div class="wrap">
        <!-- 네비게이션 바 -->
        <nav data-include-path="nav.html"></nav>
        
        <!-- 메인 콘텐츠 영역 -->
        <main>
            <section class="search_box">
                <textarea name="text" class="search" placeholder="검색할 텍스트를 입력해주세요."></textarea>
                <button type="submit" class="uploadIcon">
                    <img src="./img/upload.svg" alt="">
                </button>
                <button type="submit" class="searchIcon">
                    <img src="./img/search.svg" alt="">
                </button>
            </section>
            <section class="searchfile">
                <div class="category">
                    <button class="filenameBox">
                        <p class="filename">나의 스타일</p>
                        <span class="nothing"></span>
                    </button>
                    <button class="filenameBox">
                        <p class="filename">나의 레퍼런스</p>
                        <span class="nothing"></span>
                    </button>
                    <button class="filenameBox">
                        <p class="filename">추가 인사이트</p>
                        <span class="nothing"></span>
                    </button>
                </div>

                <button class="filter" onclick="location.href='filter.html'"><img src="./img/filter.svg" alt=""
                        class="filterIcon"></button>
                <div class="fileBox fileBox_detail">
                    <section class="searchDetail">
                        <div class="sec1">
                            <img src="./img/ex21.png" alt="" class="selectImg">
                        </div>
                        <div class="sec2wrap">
                            <div class="sec2">
                                <button class="save">저장</button>
                                <div class="sec2_1">
                                    <button class="d_download"><img src="./img/download.svg" alt=""></button>
                                    <button class="d_share"><img src="./img/share.svg" alt=""></button>
                                    <button class="d_plus"><img src="./img/plus.svg" alt=""></button>
                                </div>
                                <div id="DsettingsBox" class="D_settings-box">
                                    <ul>
                                        <li>유사 이미지 더 보기</li>
                                        <li>유사 이미지 덜 보기</li>
                                        <li>이미지 신고</li>
                                        <li>이미지 임베드 코드 가져오기</li>
                                        <li>프롬포트 추가하기</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="sec3">
                                <p class="sec_h1">추천 근거</p>
                                <p class="sec_p1">
                                    레이아웃 및 타이포그래피를 활용한 아트워크로,
                                    여백이 90%, 라인 위주 타이포그래피를 콜라주
                                    형태로 조합한 작업물로 현재 넣은 이미지와
                                    매우 높은 유사도를 보이고 있습니다.<br/>
                                    또한, 타이포그래피도 세리프가 아닌 산세리프를
                                    활용해서 모던하고 심플함이 돋보입니다.
                                </p>
                            </div>
                            <div class="sec4">
                                <p class="sec_h1">개선 방안</p>
                                <p class="sec_p1">
                                    해당 이미지처럼 여백을 최소 80% 이상
                                    확보해서 시각 보정을 통한 위계질서 수립과
                                    정리가 필요합니다. 현재는 너무 많은 그래픽
                                    요소와 방대한 정보량으로 보는 이로 하여금
                                    피로감을 들게 합니다.
                                    <br/><br/>
                                    또한, 타이포그래피를 있는 폰트 그대로 사용
                                    하는 것이 아니라, 변형을 주어서 실험적이고
                                    디자인적으로 개선된 방안을 도출해야 합니다,
                                </p>
                            </div>
                        </div>
                        
                    </section>
                    <button class="img-btn downBtn">
                        <img src="./img/download.svg" alt="" class="downIcon">
                    </button>
                    <button class="img-btn shareBtn">
                        <img src="./img/share.svg" alt="" class="shareIcon">
                    </button>
                    <div class="searchImgBox_detail">
                        <img src="./img/ex13.png" alt="" class=" searchImgD">
                        <img src="./img/ex14.png" alt="" class=" searchImgD">
                        <img src="./img/ex15.png" alt="" class=" searchImgD">
                        <img src="./img/ex16.png" alt="" class=" searchImgD">
                        <img src="./img/ex17.png" alt="" class=" searchImgD">
                        <img src="./img/ex18.png" alt="" class=" searchImgD">
                        <img src="./img/ex19.png" alt="" class=" searchImgD">
                        <img src="./img/ex20.png" alt="" class=" searchImgD">
                        <div class="page-dim"></div>
                    </div>
                </div>
            </section>

        </main>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
    // ===============================================
    //  [VW/VH 변환 함수]
    // ===============================================

    /**
     * 픽셀(px) 값을 뷰포트 너비(vw) 단위로 변환.
     * @param {number} pxValue - 픽셀 값
     * @returns {number} - 변환된 vw 값
     */
    const pxToVw = (pxValue) => {
        return (pxValue / window.innerWidth) * 100; 
    };
    
    /**
     * 픽셀(px) 값을 뷰포트 높이(vh) 단위로 변환.
     * @param {number} pxValue - 픽셀 값
     * @returns {number} - 변환된 vh 값
     */
    const pxToVh = (pxValue) => {
        return (pxValue / window.innerHeight) * 100;
    };


    // ===============================================
    // --- [1. filenameBox 클릭 이벤트 로직] ---
    // ===============================================
    const boxes = document.querySelectorAll('.filenameBox');
    
    // 초기 상태: 모든 .nothing 숨기고 첫 번째만 보이게
    boxes.forEach(box => {
        const n = box.querySelector('.nothing');
        if (n) n.style.opacity = '0';
    });
    const firstFilenameBoxNothing = boxes[0]?.querySelector('.nothing'); // 변수명 충돌 방지
    if (firstFilenameBoxNothing) firstFilenameBoxNothing.style.opacity = '1';
    if (boxes[0]) boxes[0].classList.add('active');   // 첫 번째 박스 활성화

    // 클릭 시 active 적용 + opacity 수정
    boxes.forEach(box => {
        box.addEventListener('click', () => {
            boxes.forEach(b => {
                const n = b.querySelector('.nothing');
                if (n) n.style.opacity = '0';
                b.classList.remove('active');         // 다른 박스 비활성화
            });

            const target = box.querySelector('.nothing');
            if (target) target.style.opacity = '1';
            box.classList.add('active');              // 클릭 박스 활성화
        });
    });

    // ===============================================
    // --- [2. 이미지 호버 및 버튼/page-dim 로직] ---
    // ===============================================
    
    const searchImages = document.querySelectorAll('.searchImgD');

    // 필요한 요소들을 미리 전역적으로 선언합니다.
    const downBtn = document.querySelector('.downBtn');
    const shareBtn = document.querySelector('.shareBtn');
    const fileBox = document.querySelector('.fileBox'); 
    const pageDim = document.querySelector('.page-dim');

    let pageDimHoverTimer; // page-dim 딜레이를 위한 타이머 변수
    
    // 버튼 및 아이콘 관련 변수들을 선언합니다 (null 체크는 필요 시 나중에)
    let btnWidth, btnHeight;
    let downIcon, shareIcon;
    let originalShareSrc, hoverShareSrc, originalDownSrc, hoverDownSrc;

    // downBtn, shareBtn, fileBox 중 필수 요소가 존재할 경우에만 관련 로직 변수 초기화
    if (downBtn && shareBtn && fileBox) {
        btnWidth = downBtn.offsetWidth; 
        btnHeight = downBtn.offsetHeight;
        downIcon = downBtn.querySelector('.downIcon');
        shareIcon = shareBtn.querySelector('.shareIcon');
        originalShareSrc = './img/share.svg';
        hoverShareSrc = './img/shareHover.svg'; 
        originalDownSrc = './img/download.svg';
        hoverDownSrc = './img/downHover.svg'; 
    }


    searchImages.forEach(image => {
        // 마우스 진입 (mouseenter)
        image.addEventListener('mouseenter', () => {
            // 버튼 관련 로직 (downBtn, shareBtn이 존재할 때만 실행)
            if (downBtn && shareBtn && fileBox) { // 이전에 정의된 변수들을 사용
                const imgRect = image.getBoundingClientRect();
                const fileBoxRect = fileBox.getBoundingClientRect();
                
                // fileBox 기준 이미지의 상대 위치 (px)
                const relativeLeft = imgRect.left - fileBoxRect.left;
                const relativeTop = imgRect.top - fileBoxRect.top;
                
                const imageWidth = imgRect.width;
                const imageHeight = imgRect.height;
                
                // 수직 중앙 위치 (px): 이미지 상단 + (이미지 높이 / 2) - (버튼 높이 / 2)
                const centerY = relativeTop + (imageHeight / 2) - (btnHeight / 2);

                // 다운로드 버튼 최종 위치 (px)
                const downLeftPx = relativeLeft + imageWidth - btnWidth + 25; 
                const shareLeftPx = relativeLeft - 25; 

                // --- 위치를 VW/VH로 변환하여 적용 ---
                downBtn.style.left = `${pxToVw(downLeftPx)}vw`;
                downBtn.style.top = `${pxToVh(centerY)}vh`;
                shareBtn.style.left = `${pxToVw(shareLeftPx)}vw`;
                shareBtn.style.top = `${pxToVh(centerY)}vh`;
                
                // 버튼 노출
                downBtn.style.opacity = '1';
                downBtn.style.pointerEvents = 'auto';
                shareBtn.style.opacity = '1';
                shareBtn.style.pointerEvents = 'auto';

                // 이미지 z-index/확대 효과
                image.style.zIndex = '100'; 
                image.style.transform = 'scale(1.04)';
            }

            // page-dim 딜레이 활성화 로직
            if (pageDim) { // pageDim 요소가 존재하는지 확인
                clearTimeout(pageDimHoverTimer); // 이전에 진행 중이던 타이머가 있다면 취소
                pageDimHoverTimer = setTimeout(() => {
                    pageDim.classList.add('active'); // page-dim을 보이도록 'active' 클래스 추가
                }, 1000); // 1000밀리초 = 1초
            }
        });

        // 마우스 이탈 (mouseleave)
        image.addEventListener('mouseleave', () => {
            // 버튼 숨김 (downBtn, shareBtn이 존재할 때만 실행)
            if (downBtn && shareBtn) {
                downBtn.style.opacity = '0';
                downBtn.style.pointerEvents = 'none';
                shareBtn.style.opacity = '0';
                shareBtn.style.pointerEvents = 'none';

                // 이미지 z-index/확대 효과 복구
                image.style.zIndex = '';
                image.style.transform = '';
            }

            // page-dim 딜레이 활성화 타이머 취소 및 숨김 로직
            if (pageDim) { // pageDim 요소가 존재하는지 확인
                clearTimeout(pageDimHoverTimer); // 진행 중이던 타이머가 있다면 즉시 취소
                pageDim.classList.remove('active'); // page-dim이 활성화되어 있다면 숨김
            }
        });
    });

    // page-dim 자체가 화면에 떠 있을 때 page-dim 위로 마우스가 올라갔다 벗어났을 경우 처리
    if (pageDim) {
        pageDim.addEventListener('mouseleave', () => {
            clearTimeout(pageDimHoverTimer); // 혹시 모를 타이머 취소
            pageDim.classList.remove('active'); // page-dim을 숨김
        });
    }

    // ===============================================
    // --- [3. 버튼 자체 호버 처리 로직 및 이미지 SRC 변경 로직] ---
    // ===============================================
    // downBtn, shareBtn이 모두 존재할 경우에만 실행
    if (downBtn && shareBtn) {
        const allButtons = [downBtn, shareBtn];
        allButtons.forEach(btn => {
            const icon = btn === downBtn ? downIcon : shareIcon; // 이미 위에서 선언된 downIcon, shareIcon 사용
            const originalSrc = btn === downBtn ? originalDownSrc : originalShareSrc;
            const hoverSrc = btn === downBtn ? hoverDownSrc : hoverShareSrc;
            
            btn.addEventListener('mouseenter', () => {
                // 1. 마우스가 버튼 위로 올라오면 유지 (버튼 노출)
                // searchImages의 mouseenter/mouseleave로 제어되던 상태를 여기서 유지시킴
                btn.style.opacity = '1';
                btn.style.pointerEvents = 'auto';
                
                // 2. 내부 아이콘 경로 변경 (호버 이미지 적용)
                if (icon) icon.src = hoverSrc;
            });

            btn.addEventListener('mouseleave', () => {
                // 1. 마우스가 버튼에서 나가면 숨김 (버튼 숨김)
                // 이 부분을 어떻게 처리할지 중요. 이미지가 아닌 버튼 자체를 벗어날 때 바로 사라지게 함
                btn.style.opacity = '0';
                btn.style.pointerEvents = 'none';

                // 2. 내부 아이콘 경로 복구 (원본 이미지 적용)
                if (icon) icon.src = originalSrc;
            });
        });
    }

    // ===============================================
    // --- [4. D_settingsBox 토글 로직] ---
    // ===============================================
    const dPlusButton = document.querySelector('.d_plus'); // d_plus 버튼 선택
    const settingsBox = document.getElementById('DsettingsBox'); // 설정 박스 선택

    // dPlusButton과 settingsBox가 모두 존재할 때만 로직 실행
    if (dPlusButton && settingsBox) {
        // 1. d_plus 버튼 클릭 시 설정 박스 토글
        dPlusButton.addEventListener('click', (event) => {
            event.stopPropagation(); // 클릭 이벤트가 document까지 전파되는 것을 막아, 바로 사라지는 것을 방지
            settingsBox.classList.toggle('show'); // 'show' 클래스를 추가/제거하여 보이거나 숨김
        });

        // 2. 문서의 아무 곳이나 클릭했을 때 설정 박스 숨기기
        document.addEventListener('click', (event) => {
            // 클릭된 요소가 설정 박스 자신이거나 설정 박스의 자식 요소가 아닌 경우 AND
            // 설정 박스가 현재 보이는 상태인 경우에만 숨깁니다.
            if (!settingsBox.contains(event.target) && settingsBox.classList.contains('show')) {
                settingsBox.classList.remove('show');
            }
        });
    } else {
        // console.warn("d_plus 버튼 또는 DsettingsBox 요소를 찾을 수 없습니다. 설정 박스 토글 로직이 작동하지 않습니다.");
    }
});
    </script>
</body>

</html>